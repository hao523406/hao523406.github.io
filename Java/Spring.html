<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring | Hao-Blog</title>
    <meta name="description" content="豪神博客">
    
    
    <link rel="preload" href="/assets/css/0.styles.595b60ed.css" as="style"><link rel="preload" href="/assets/js/app.04a292d2.js" as="script"><link rel="preload" href="/assets/js/2.4fad892d.js" as="script"><link rel="preload" href="/assets/js/10.8e879de9.js" as="script"><link rel="prefetch" href="/assets/js/11.b217e124.js"><link rel="prefetch" href="/assets/js/12.013bff42.js"><link rel="prefetch" href="/assets/js/13.3cdff795.js"><link rel="prefetch" href="/assets/js/14.b5ab60e6.js"><link rel="prefetch" href="/assets/js/15.50bec27e.js"><link rel="prefetch" href="/assets/js/16.c16c9f53.js"><link rel="prefetch" href="/assets/js/3.30ead0c9.js"><link rel="prefetch" href="/assets/js/4.c0014c96.js"><link rel="prefetch" href="/assets/js/5.811e20e2.js"><link rel="prefetch" href="/assets/js/6.dba0d004.js"><link rel="prefetch" href="/assets/js/7.35746c6c.js"><link rel="prefetch" href="/assets/js/8.6b384213.js"><link rel="prefetch" href="/assets/js/9.9b657d40.js">
    <link rel="stylesheet" href="/assets/css/0.styles.595b60ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hao-Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/Spring.html#介绍" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#ioc-控制反转" class="sidebar-link">IOC(控制反转)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#di-依赖注入" class="sidebar-link">DI(依赖注入)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#applicationcontext" class="sidebar-link">ApplicationContext</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#bean" class="sidebar-link">bean</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#创建时机" class="sidebar-link">创建时机</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#实例化方式" class="sidebar-link">实例化方式</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#作用域" class="sidebar-link">作用域</a></li></ul></li><li><a href="/Java/Spring.html#xml配置" class="sidebar-link">XML配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#import" class="sidebar-link">&lt;import&gt;</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#beans" class="sidebar-link">&lt;beans&gt;</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#bean-2" class="sidebar-link">&lt;bean&gt;</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#context-annotation-config" class="sidebar-link">&lt;context:annotation-config&gt;</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#context-component-scan" class="sidebar-link">&lt;context:component-scan&gt;</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#context-property-placeholder" class="sidebar-link">&lt;context:property-placeholder&gt;</a></li></ul></li><li><a href="/Java/Spring.html#di-依赖注入-2" class="sidebar-link">DI(依赖注入)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#注解配置" class="sidebar-link">注解配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#autowired" class="sidebar-link">@Autowired</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#resource" class="sidebar-link">@Resource</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#component" class="sidebar-link">@Component</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#scope" class="sidebar-link">@Scope</a></li></ul></li><li><a href="/Java/Spring.html#属性占位符" class="sidebar-link">属性占位符</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#动态代理" class="sidebar-link">动态代理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#jdk动态代理" class="sidebar-link">JDK动态代理</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#cglib动态代理" class="sidebar-link">CGLib动态代理</a></li></ul></li><li><a href="/Java/Spring.html#aop概念" class="sidebar-link">AOP概念</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#aspectj" class="sidebar-link">AspectJ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#xml实现aop" class="sidebar-link">XML实现AOP</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#aop的各种增强" class="sidebar-link">AOP的各种增强</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#注解实现aop" class="sidebar-link">注解实现AOP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#aspect" class="sidebar-link">@Aspect</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#pointcut" class="sidebar-link">@Pointcut</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#before" class="sidebar-link">@Before</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#afterreturning" class="sidebar-link">@AfterReturning</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#afterthrowing" class="sidebar-link">@AfterThrowing</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#after" class="sidebar-link">@After</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#around" class="sidebar-link">@Around</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#使用" class="sidebar-link">使用</a></li></ul></li><li><a href="/Java/Spring.html#jdbctemplate" class="sidebar-link">JdbcTemplate</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#jdbcdaosupport" class="sidebar-link">JdbcDaoSupport</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#获取自增主键" class="sidebar-link">获取自增主键</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#事务管理的主要接口" class="sidebar-link">事务管理的主要接口</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/Spring.html#声明式事务管理" class="sidebar-link">声明式事务管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#xml配置-2" class="sidebar-link">XML配置</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#注解配置-2" class="sidebar-link">注解配置</a></li></ul></li><li><a href="/Java/Spring.html#组件注册" class="sidebar-link">组件注册</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#configuration" class="sidebar-link">@Configuration</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#bean-3" class="sidebar-link">@Bean</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#componentscan" class="sidebar-link">@ComponentScan</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#componentscans" class="sidebar-link">@ComponentScans</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#filtertype" class="sidebar-link">FilterType</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#scope-2" class="sidebar-link">@Scope</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#lazy" class="sidebar-link">@Lazy</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#conditional" class="sidebar-link">@Conditional</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#import-2" class="sidebar-link">@Import</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#factorybean" class="sidebar-link">FactoryBean</a></li></ul></li><li><a href="/Java/Spring.html#生命周期" class="sidebar-link">生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#bean-4" class="sidebar-link">@Bean</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#initializingbean" class="sidebar-link">InitializingBean</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#disposablebean" class="sidebar-link">DisposableBean</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#postconstruct" class="sidebar-link">@PostConstruct</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#predestroy" class="sidebar-link">@PreDestroy</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#beanpostprocessor" class="sidebar-link">BeanPostProcessor</a></li></ul></li><li><a href="/Java/Spring.html#属性赋值" class="sidebar-link">属性赋值</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#value" class="sidebar-link">@Value</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#propertysource" class="sidebar-link">@PropertySource</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#propertysources" class="sidebar-link">@PropertySources</a></li></ul></li><li><a href="/Java/Spring.html#自动装配-2" class="sidebar-link">自动装配</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#autowired-2" class="sidebar-link">@Autowired</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#resource-2" class="sidebar-link">@Resource</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#primary" class="sidebar-link">@Primary</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#inject" class="sidebar-link">@Inject</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#xxxaware" class="sidebar-link">XxxAware</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#profile" class="sidebar-link">@Profile</a></li></ul></li><li><a href="/Java/Spring.html#aop-2" class="sidebar-link">AOP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#aspect-2" class="sidebar-link">@Aspect</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#pointcut-2" class="sidebar-link">@Pointcut</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#before-2" class="sidebar-link">@Before</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#after-2" class="sidebar-link">@After</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#afterreturning-2" class="sidebar-link">@AfterReturning</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#afterthrowing-2" class="sidebar-link">@AfterThrowing</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#around-2" class="sidebar-link">@Around</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#enableaspectjautoproxy" class="sidebar-link">@EnableAspectJAutoProxy</a></li></ul></li><li><a href="/Java/Spring.html#事务" class="sidebar-link">事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#datasource" class="sidebar-link">DataSource</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#platformtransactionmanager" class="sidebar-link">PlatformTransactionManager</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#enabletransactionmanagement" class="sidebar-link">@EnableTransactionManagement</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#transactional" class="sidebar-link">@Transactional</a></li></ul></li><li><a href="/Java/Spring.html#扩展" class="sidebar-link">扩展</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Spring.html#beanfactorypostprocessor" class="sidebar-link">BeanFactoryPostProcessor</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#beandefinitionregistrypostprocessor" class="sidebar-link">BeanDefinitionRegistryPostProcessor</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#applicationlistener" class="sidebar-link">ApplicationListener</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#eventlistener" class="sidebar-link">@EventListener</a></li><li class="sidebar-sub-header"><a href="/Java/Spring.html#smartinitializingsingleton" class="sidebar-link">SmartInitializingSingleton</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring"><a href="#spring" class="header-anchor">#</a> Spring</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <ul><li>轻量级：Spring 是非侵入性的 - 基于 Spring 开发的应用中的对象可以不依赖于 Spring 的 API</li> <li>依赖注入(DI --- dependency injection、IOC)</li> <li>面向切面编程(AOP --- aspect oriented programming)</li> <li>容器: Spring 是一个容器, 因为它包含并且管理应用对象的生命周期</li> <li>框架: Spring 实现了使用简单的组件配置组合成一个复杂的应用. 在 Spring 中可以使用 XML 和 Java 注解组合这些对象</li> <li>一站式：在 IOC 和 AOP 的基础上可以整合各种企业应用的开源框架和优秀的第三方类库 （实际上 Spring 自身也提供了展现层的 SpringMVC 和 持久层的 Spring JDBC）</li></ul> <p><img src="spring-%E6%A8%A1%E5%9D%97.png" alt="&quot;模块&quot;"></p> <h2 id="ioc-控制反转"><a href="#ioc-控制反转" class="header-anchor">#</a> IOC(控制反转)</h2> <p>IOC(Inversion of Control)：指将对象的创建权，反转给了Spring容器.</p> <p>其思想是反转资源获取的方向. 应用了 IOC 之后, 容器主动地将资源推送给它所管理的组件, 组件所要做的仅是选择一种合适的方式来接受资源.</p> <ul><li><strong>正控</strong>：若调用者需要使用某个对象，其自身就得负责该对象的创建。</li> <li><strong>反控</strong>：调用者只管负责从Spring容器中获取需要使用的对象，不关心对象的创建过程，也就是把创建对象的控制权反转给了Spring框架。</li></ul> <h2 id="di-依赖注入"><a href="#di-依赖注入" class="header-anchor">#</a> DI(依赖注入)</h2> <p>DI(Dependency Injection)：指Spring创建对象的过程中，将对象依赖属性（简单值，集合，对象）通过配置设值给该对象.</p> <p>IOC 的另一种表述方式——即组件以一些预先定义好的方式(例如: setter 方法)接受来自如容器的资源注入. 相对于 IOC 而言，这种表述更直接.</p> <br> <h1 id="spring-入门程序"><a href="#spring-入门程序" class="header-anchor">#</a> Spring 入门程序</h1> <ol><li><p>导入jar包</p> <ul><li>spring-beans-5.1.7.RELEASE.jar</li> <li>spring-core-5.1.7.RELEASE.jar</li></ul></li> <li><p>准备</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; : Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- reources下的 applicationContext.xml --&gt;</span>
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myBean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.domain.MyBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>小米<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>测试</p> <p><img src="spring-%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95.png" alt="&quot;测试&quot;"></p></li> <li><p>分析</p></li></ol> <ul><li>BeanFactory对象.<strong>getBean( )</strong> 三种方法签名：
<ul><li>getBean( <strong>bean类型</strong> ) : 要求bean类型唯一.</li> <li>getBean( <strong>bean名字</strong> )</li> <li>getBean( <strong>bean名字, bean类型</strong> ) : 推荐.</li></ul></li></ul> <br> <h1 id="spring-测试"><a href="#spring-测试" class="header-anchor">#</a> Spring 测试</h1> <p><img src="spring-%E6%B5%8B%E8%AF%95%E5%AF%B9%E6%AF%94.png" alt="&quot;测试对比&quot;"></p> <ol><li><p>测试依赖jar包：</p> <ul><li><p>junit-4.12.jar (4.12以上版本)</p></li> <li><p>hamcrest-core-1.3.jar</p></li> <li><p>spring-aop-5.1.7.RELEASE.jar</p></li> <li><p>spring-beans-5.1.7.RELEASE.jar</p></li> <li><p>spring-context-5.1.7.RELEASE.jar</p></li> <li><p>spring-core-5.1.7.RELEASE.jar</p></li> <li><p>spring-test-5.1.7.RELEASE.jar</p></li></ul></li> <li><p>步骤</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:applicationContext.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MyBean</span> myBean<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	myBean<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>如果把<code>@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</code>写成<code>@ContextConfiguration</code>：默认去找当前测试类名-context.xml配置文件(如：AppTest-context.xml)</p></blockquote> <br> <h1 id="ioc容器"><a href="#ioc容器" class="header-anchor">#</a> IOC容器</h1> <h2 id="applicationcontext"><a href="#applicationcontext" class="header-anchor">#</a> ApplicationContext</h2> <ul><li><p><code>BeanFactory</code>：是Spring中最底层的接口，只提供了最简单的IoC功能,负责配置，创建和管理bean.</p> <ul><li><p>Spring最基本的接口,表示Spring容器. 生产bean对象的工厂,负责配置,创建和管理bean.</p></li> <li><p>备注：bean是Spring管理的单位，在Spring中一切都是bean。</p></li></ul></li> <li><p><code>ApplicationContext</code>：在应用中，一般不使用BeanFactory，而推荐使用ApplicationContext。</p> <p>原因如下（BeanFactory和ApplicationContext的区别）：</p> <ul><li>ApplicationContext继承了BeanFactory，拥有了基本的IoC功能。</li> <li>除此之外，ApplicationContext还提供了以下的功能：
<ul><li><p>支持国际化；</p></li> <li><p>支持消息机制；</p></li> <li><p>支持统一的资源加载；</p></li> <li><p>支持AOP功能；</p></li></ul></li></ul></li> <li><p>ApplicationContext <strong>常见实现类</strong>：</p> <ul><li><code>ClassPathXmlApplicationContext</code>  ：读取classpath中的资源</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>FileSystemXmlApplicationContext</code>  ：读取指定路径的资源</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> 
    <span class="token keyword">new</span> <span class="token class-name">FileSystemXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;c:/applicationContext.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>XmlWebApplicationContext</code>  ：需要在Web的环境下才可以运行</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">XmlWebApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlWebApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这时没有初始化容器</span>
ctx<span class="token punctuation">.</span><span class="token function">setServletContext</span><span class="token punctuation">(</span> <span class="token class-name">ServletContext</span>对象 <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//指定ServletContext对象</span>
ctx<span class="token punctuation">.</span><span class="token function">setConfigLocation</span><span class="token punctuation">(</span> <span class="token string">&quot;applicationContext.xml路径&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//指定spring配置文件路径</span>
ctx<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 初始化容器</span>
</code></pre></div></li></ul> <h2 id="bean"><a href="#bean" class="header-anchor">#</a> bean</h2> <h3 id="创建时机"><a href="#创建时机" class="header-anchor">#</a> 创建时机</h3> <ul><li><code>ApplicationContext</code>初始化就会创建所有bean。（Web应用）</li> <li><code>BeanFactory</code>需要等到获取bean才会创建bean。（桌面应用）</li></ul> <h3 id="实例化方式"><a href="#实例化方式" class="header-anchor">#</a> 实例化方式</h3> <ul><li>构造器实例化(无参数构造器)（使用最多）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">SomeBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>someBean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.domain.SomeBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li>静态工厂方法实例化（解决系统遗留问题）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeBeanFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SomeBean</span> <span class="token function">getSomeBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SomeBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>someBean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.factory.SomeBeanFactory<span class="token punctuation">&quot;</span></span> 
      <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>getSomeBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li>实例工厂方法实例化（解决系统遗留问题）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeBeanFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">SomeBean</span> <span class="token function">getSomeBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SomeBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>someBeanFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.factory.SomeBeanFactory<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>someBean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>someBeanFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>getSomeBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li>实现 <code>FactoryBean</code>接口 实例化（集合其他框架使用）
<code>org.springframework.beans.factory.FactoryBean</code></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeBeanFactory</span> <span class="token keyword">implements</span> <span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SomeBean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">SomeBean</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SomeBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SomeBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// true: 单例     false: 多例(默认实现)</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>someBean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.factory.SomeBeanFactory<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="作用域"><a href="#作用域" class="header-anchor">#</a> 作用域</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span>bean scope<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><table><thead><tr><th>scope</th> <th>说明</th></tr></thead> <tbody><tr><td>singleton</td> <td>单例。容器创建完成就会创建bean，并调用 init-method 指定的方法。<br>容器关闭调用 destroy-method 指定的方法。</td></tr> <tr><td>prototype</td> <td>多例。容器创建完成不会创建bean。用到才会创建并调用 init-method 指定的方法。<br>容器关闭并不会调用 destroy-method 指定的方法，需要使用者自己调用destroy方法。</td></tr></tbody></table> <h2 id="xml配置"><a href="#xml配置" class="header-anchor">#</a> XML配置</h2> <h3 id="import"><a href="#import" class="header-anchor">#</a> <code>&lt;import&gt;</code></h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>classpath: 其他spring配置xml文件<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>注意：</p> <ul><li>默认情况下，从classpath的根路径寻找。</li> <li>可以使用前缀来定位文件的基础位置，只有实现了Resource接口才能够识别前缀标识符。
<ul><li>classpath (推荐)</li> <li>file</li></ul></li></ul> <hr> <h3 id="beans"><a href="#beans" class="header-anchor">#</a> <code>&lt;beans&gt;</code></h3> <ul><li>常用属性 :
<ul><li><strong>default-lazy-init</strong> :</li> <li><strong>default-init-method</strong> :</li> <li><strong>default-destroy-method</strong> :</li> <li><strong>default-autowire</strong> :</li> <li><strong>default-autowire-candidates</strong></li></ul></li></ul> <hr> <h3 id="bean-2"><a href="#bean-2" class="header-anchor">#</a> <code>&lt;bean&gt;</code></h3> <ul><li><p>常用属性</p> <ul><li><strong>id</strong>：bean的唯一标识。</li> <li><strong>name</strong>：别名，可以多个，用 逗号或空格 隔开。</li> <li><strong>class</strong>：bean的全限定类名 或 factory的全限定类名。</li> <li><strong>scope</strong>：作用域。
<ul><li>singleton：单例，容器仅存在一个bean实例。</li> <li>prototype：多例，每次获取都是一个新的实例。</li></ul></li> <li><strong>init-method</strong>：bean的初始化方法</li> <li><strong>destroy-method</strong>：的bean销毁方法</li> <li><strong>autowire</strong>：自动装配
<ul><li>default：no。</li> <li>no：不要自动注入。</li> <li>byName：按照属性名字注入bean。</li> <li>byType：按照属性类型注入bean。</li> <li>constructor：按照构造器的参数类型注入bean。</li></ul></li> <li><strong>abstract</strong>：抽象，作为<code>&lt;bean&gt;</code>元素的父元素被继承。
<ul><li>true：不需要Spring容器来实例化该类。</li> <li>false：Spring容器来实例化该类。</li></ul></li> <li><strong>parent</strong>：继承<code>父&lt;bean&gt;</code>。值：<code>父&lt;bean&gt;</code>的id，仅仅继承(拷贝)<code>父&lt;bean&gt;</code>的配置，并不是Java的继承。</li></ul></li> <li><p>常用子元素</p> <ul><li><strong>property</strong>：属性注入。
<ul><li>name</li> <li>value</li> <li>ref：</li></ul></li> <li><strong>constructor</strong>：构造器注入。
<ul><li>value</li> <li>ref</li> <li>name</li> <li>index</li> <li>type</li></ul></li></ul></li></ul> <hr> <h3 id="context-annotation-config"><a href="#context-annotation-config" class="header-anchor">#</a> <code>&lt;context:annotation-config&gt;</code></h3> <ul><li>开启支持注解的驱动。</li></ul> <hr> <h3 id="context-component-scan"><a href="#context-component-scan" class="header-anchor">#</a> <code>&lt;context:component-scan&gt;</code></h3> <ul><li>常用属性：
<ul><li><strong>base-package</strong>：全限定包名。多个包名可用 逗号 隔开。</li></ul></li></ul> <hr> <h3 id="context-property-placeholder"><a href="#context-property-placeholder" class="header-anchor">#</a> <code>&lt;context:property-placeholder&gt;</code></h3> <ul><li>常用属性：
<ul><li><strong>location</strong>：properties文件的位置。例：<code>classpath:db.properties</code>。</li> <li><strong>file-encoding</strong>：文件编码。</li> <li><strong>ignore-unresolvable</strong>：是否忽略解析不到的属性。
设置为true，用于加载多个properties。</li></ul></li></ul> <h2 id="di-依赖注入-2"><a href="#di-依赖注入-2" class="header-anchor">#</a> DI(依赖注入)</h2> <ul><li><p>DI (Dependency Injection)：Spring创建对象的过程中，将对象依赖属性通过配置进行注入。</p></li> <li><p>注入方式：</p> <ul><li>自动装配</li> <li>手动装配</li></ul></li></ul> <h4 id="自动装配"><a href="#自动装配" class="header-anchor">#</a> 自动装配</h4> <p>设置<code>&lt;bean&gt;</code>的 <strong>autowire</strong> 属性.</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>someBean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.domain.SomeBean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autowire</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>xxx<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><h4 id="手动装配"><a href="#手动装配" class="header-anchor">#</a> 手动装配</h4> <ul><li><p>注入方式：</p> <ul><li><strong>属性</strong>注入（<strong>Setter</strong>方法）</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>xxx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bean的全限定类名<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>属性名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>属性值<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><ul><li>在配置文件中的值都是string，string可以自动完成类型的转换。</li> <li>属性的注入在 init-method 执行之前完成。</li> <li>顺序：构造器 -&gt; 属性注入 -&gt; init-method.</li></ul></blockquote> <ul><li><strong>构造器</strong>注入</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>xxx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bean的全限定类名<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>参数名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>参数值<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><strong>SpEL</strong>注入</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>xxx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bean的全限定类名<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>属性名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#{SpEL表达式}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <hr> <ul><li><p>可注入的类型：</p> <ul><li><strong>简单</strong>类型</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code></code></pre></div></li></ul> <property name="属性名" value="简单值"></property>
	```
<pre><code>* **引用**类型

```xml
</code></pre> <bean id="xxx" class="某bean的全限定类名"></bean> <property name="属性名"></property>
    ```
<pre><code>* **集合**类型
```xml
&lt;property name=&quot;属性名&quot;&gt;
    &lt;!--Set集合--&gt;
    &lt;set&gt;
        &lt;value&gt;值1&lt;/value&gt;
        &lt;value&gt;值2&lt;/value&gt;
        &lt;value&gt;值3&lt;/value&gt;
    &lt;/set&gt;
&lt;/property&gt;

&lt;property name=&quot;属性名&quot;&gt;
    &lt;!--List集合--&gt;
    &lt;list&gt;
        &lt;value&gt;值1&lt;/value&gt;
        &lt;value&gt;值2&lt;/value&gt;
        &lt;value&gt;值3&lt;/value&gt;
    &lt;/list&gt;
&lt;/property&gt;

&lt;property name=&quot;属性名&quot;&gt;
    &lt;!--String数组--&gt;
    &lt;array&gt;
        &lt;value&gt;值1&lt;/value&gt;
        &lt;value&gt;值2&lt;/value&gt;
        &lt;value&gt;值3&lt;/value&gt;
    &lt;/array&gt;
&lt;/property&gt;

&lt;property name=&quot;属性名&quot;&gt;
    &lt;!--Map集合--&gt;
    &lt;map&gt;
        &lt;entry key=&quot;键1&quot; value=&quot;值1&quot;/&gt;
        &lt;entry key=&quot;键2&quot; value=&quot;值2&quot;/&gt;
        &lt;entry key=&quot;键3&quot; value=&quot;值3&quot;/&gt;
    &lt;/map&gt;
&lt;/property&gt;

&lt;property name=&quot;属性名&quot;&gt;
    &lt;!--Properties集合--&gt;
    &lt;props&gt;
        &lt;prop key=&quot;键1&quot;&gt;值1&lt;/prop&gt;
        &lt;prop key=&quot;键2&quot;&gt;值2&lt;/prop&gt;
        &lt;prop key=&quot;键3&quot;&gt;值3&lt;/prop&gt;
    &lt;/props&gt;
&lt;/property&gt;

&lt;property name=&quot;属性名&quot;&gt;
    &lt;!--Properties集合，另一种写法--&gt;
    &lt;value&gt;
        p1=v1
        p2=v2
        p3=v3
    &lt;/value&gt;
&lt;/property&gt;
```
</code></pre> <h2 id="注解配置"><a href="#注解配置" class="header-anchor">#</a> 注解配置</h2> <p>依赖注入：</p> <ul><li><p>通过<code>@Autowired</code>或<code>@Resource</code>可以让Spring自动的把需要的对象容器找出来，并注入给该成员。</p></li> <li><p>可以注入Spring内置的重要对象。（如：BeanFactory、ApplicationContext等）</p></li> <li><p>使用注解需要引入解析器：<code>&lt;context:annotation-config /&gt;</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- applicationContext.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div></li></ul> <hr> <h3 id="autowired"><a href="#autowired" class="header-anchor">#</a> <code>@Autowired</code></h3> <ul><li><p>Spring定义的标签，所以对象和spring框架关联。</p></li> <li><p>可标注位置：构造器，方法，参数，字段，注解</p></li> <li><p>可以使用<code>@Qualifier(&quot;bean的id&quot;)</code>标签来规定依赖对象：按照 bean的id+类型 去找。</p></li> <li><p>默认情况下使用<code>@Autowired</code>必须能找到对象，否则报错。</p> <ul><li>可用 <strong>required</strong> 来避免：<code>@Autowired( required=false )</code></li></ul></li> <li><p>找bean方式：</p> <ol><li>首先按照 <strong>依赖对象的类型</strong> 找，找到则使用 Setter方法或字段 直接注入。</li> <li>如果找到多个匹配的类型，再按照 <strong>名字</strong> 找，没有匹配则报错。</li> <li>如果配合 <code>@Qualifier(&quot;beanId&quot;)</code> ，需要同时匹配类型和名字，否则报错。</li></ol></li> <li><p>使用：</p> <ul><li>字段</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Person</span> person<span class="token punctuation">;</span>
</code></pre></div><ul><li>方法</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 为一个属性注入多个对象。（独有功能）</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAB</span><span class="token punctuation">(</span><span class="token class-name">A</span> a<span class="token punctuation">,</span> <span class="token class-name">B</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>构造器</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 如果bean只有一个有参构造器，@Autowired 可以不写，参数能自动注入进来。</span>
<span class="token keyword">public</span> <span class="token class-name">Car</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@Autowired</span> <span class="token class-name">A</span> a <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <h3 id="resource"><a href="#resource" class="header-anchor">#</a> <code>@Resource</code></h3> <ul><li><p>JavaEE规范的标签，在J2EE规范容器中也能正常使用。</p></li> <li><p>可标注位置：类，接口，枚举，字段，方法</p></li> <li><p>找bean方式：</p> <ol><li>首先按照 <strong>名字</strong> 找，找到则使用 Setter方法或字段 注入。</li> <li>如果名字找不到，再按照 <strong>类型</strong> 找。但匹配多个类型则报错。</li> <li>使用 <code>@Resource( name=&quot;beanId&quot; )</code> 只能按照名字找，找不到也不会按照类型找</li></ol></li> <li><p>使用：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Person</span> person<span class="token punctuation">;</span>
</code></pre></div></li></ul> <hr> <h3 id="component"><a href="#component" class="header-anchor">#</a> <code>@Component</code></h3> <p>bean的注入，相当于  <code>&lt;bean id=&quot;名字&quot; class=&quot;全限定类名&quot; /&gt;</code>。</p> <ul><li><p>默认名字：首字母小写的类名。</p></li> <li><p>修改名字：属性 <strong>value=&quot;名字&quot;</strong>。</p></li> <li><p>使用：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">&quot;mybean&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>限制：</p> <ul><li>不能使用到 静态工厂方法 和 实例工厂方法 实例化bean的类，但可以使用到 实现<code>FactoryBean</code>接口实例化bean的类。</li> <li>对于没有源代码的类，只能使用XML配置。</li></ul></li> <li><p>bean组件版型注解：</p> <ul><li><code>@Service</code> : 业务层</li> <li><code>@Controller</code> : 控制层</li> <li><code>@Repository</code> : 数据层</li> <li><code>@Component</code> : 泛指组件</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span><span class="token punctuation">(</span><span class="token string">&quot;userDao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IUserDao</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IUserService</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;userDao&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">IUserDao</span> userDao<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;userController&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">IUserService</span> userService<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="scope"><a href="#scope" class="header-anchor">#</a> <code>@Scope</code></h3> <p>作用域：相当于 <code>&lt;bean scope=&quot;作用域&quot; /&gt;</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span><span class="token punctuation">(</span><span class="token string">&quot;userAction&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">&quot;prototype&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAction</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="属性占位符"><a href="#属性占位符" class="header-anchor">#</a> 属性占位符</h2> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- ${key} 获取到properties的value --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>属性名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${Properties的key}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>连接池案例：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># db.properties</span>
<span class="token attr-name">db.driver</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">db.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/hrm</span>
<span class="token attr-name">db.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">db.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>
<span class="token attr-name">db.maxActive</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
</code></pre></div><p><img src="spring-%E5%BC%95%E5%85%A5%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4.png" alt="&quot;引入命名空间&quot;"></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- applicationContext.xml --&gt;</span>

<span class="token comment">&lt;!-- 引入属性配置文件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>classpath:db.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!-- 配置连接池 (使用 属性占位符) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">&quot;</span></span> 
      <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>init<span class="token punctuation">&quot;</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>close<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${db.driver}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${db.url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${db.username}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${db.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>maxActive<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${db.maxActive}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><p>Spring2.5 引入一个新的 <strong>p命名空间</strong> (其它字母不行)，通过<code>&lt;bean&gt;</code>元素属性的方式配置bean。</p> <p><img src="spring-%E5%81%87%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4p.png" alt="&quot;假命名空间p&quot;"></p></li></ul> <br> <h1 id="aop"><a href="#aop" class="header-anchor">#</a> AOP</h1> <h2 id="动态代理"><a href="#动态代理" class="header-anchor">#</a> 动态代理</h2> <ul><li><strong>动态代理类</strong>：程序运行期间由JVM通过反射等机制动态生成，所以不存在代理类的字节码文件。代理对象和真实对象的关系是程序运行才确定的。</li> <li><strong>原理</strong>：创建代理对象，代理对象在 <strong>处理器</strong> 中实现<strong>增强操作</strong>（对真实对象执行的方法的增强）。</li> <li><strong>最小单位</strong>：类。（所有类中的方法都会被处理）
会拦截所有public方法，如果只想拦截部分方法，需要在invoke(下面讲)方法进行过滤。</li></ul> <hr> <ul><li>案例准备：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMoneyService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 转账</span>
    <span class="token keyword">void</span> <span class="token function">transAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MoneyServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IMoneyService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 转账：A-&gt;B</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;A转出1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B转入1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionManager</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;开启事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;提交事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;回滚事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;释放资源&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="jdk动态代理"><a href="#jdk动态代理" class="header-anchor">#</a> JDK动态代理</h3> <p>Java动态代理机制生成的所有动态代理类的父类, 它提供了一组静态方法来为一组接口动态地生成代理类及其对象.</p> <ul><li><p>创建代理对象：<code>java.lang.reflect.Proxy</code> 。</p> <div class="language-java extra-class"><pre class="language-java"><code></code></pre></div></li></ul> <p>// 静态方法，返回：代理对象
public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler handler) throws IllegalArgumentException
```</p> <pre><code>* 参数：
    * ClassLoader **loader**：类加载器
    * Class&lt;?&gt;[] **interfaces**：真实对象实现的接口
    * InvocationHandler **handler**：代理执行处理器
</code></pre> <ul><li><p>代理执行处理器：实现 <code>java.lang.reflect.InvocationHandler</code> 接口。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 返回：代理方法执行结果</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">{</span>
    <span class="token comment">// 对真实方法的增强操作</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>参数：
<ul><li>Object <strong>proxy</strong>：真实对象</li> <li>Method <strong>method</strong>：真实对象当前调用的方法</li> <li>Object[] <strong>args</strong>：当前调用方法的实参</li></ul></li></ul></li> <li><p>注意：</p> <ul><li>代理对象必须实现接口。</li></ul></li> <li><p>案例实现：</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionManagerHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Setter</span>
    <span class="token keyword">private</span> <span class="token class-name">TransactionManager</span> transactionManager<span class="token punctuation">;</span>   <span class="token comment">// 事务管理器</span>

    <span class="token annotation punctuation">@Setter</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>  <span class="token comment">// 真实对象</span>
    
    <span class="token comment">// 创建并返回代理对象</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 具体方法的增强处理</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        transactionManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 开启事务</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 执行具体的业务方法</span>
            transactionManager<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提交事务</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            transactionManager<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 回滚事务</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            transactionManager<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 释放资源</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 事务管理器 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.tx.TransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    
    <span class="token comment">&lt;!-- 代理对象处理器 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.tx.TransactionManagerHandler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>target<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 真实对象 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.service.impl.MoneyServiceImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><hr> <h3 id="cglib动态代理"><a href="#cglib动态代理" class="header-anchor">#</a> CGLib动态代理</h3> <p>​	CGLib (Code Generation Library) 动态代理：原理是对指定的目标类生成一个子类，并覆盖其中方法实现增强，但因为采用的是继承，所以不能对final修饰的类进行代理。</p> <ul><li><p>创建代理对象：<code>org.springframework.cglib.proxy.Enhancer</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 创建 Enhancer(增强器)对象</span>
<span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置要增强的父类(真实对象)</span>
enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span> <span class="token class-name">Class</span> superclass <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 做什么增强，回调到 org.springframework.cglib.proxy.InvocationHandler的invoke方法</span>
enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span> <span class="token keyword">final</span> <span class="token class-name">Callback</span> callback <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 创建代理对象</span>
</code></pre></div></li> <li><p>代理执行处理器：实现 <code>org.springframework.cglib.proxy.InvocationHandler</code> 接口。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 返回：代理方法执行结果</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">{</span>
    <span class="token comment">// 对真实方法的增强操作</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>参数：
<ul><li>Object <strong>proxy</strong>：真实对象</li> <li>Method <strong>method</strong>：真实对象当前调用的方法</li> <li>Object[] <strong>args</strong>：当前调用方法的实参</li></ul></li></ul></li> <li><p>注意：</p> <ul><li>类不能是final的，拦截的方法要是非final、非static、非private的。</li></ul></li> <li><p>案例实现：</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionManagerCallback</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Setter</span>
    <span class="token keyword">private</span> <span class="token class-name">TransactionManager</span> transactionManager<span class="token punctuation">;</span>   <span class="token comment">// 事务管理器</span>

    <span class="token annotation punctuation">@Setter</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>  <span class="token comment">// 真实对象</span>

    <span class="token comment">// 创建并返回代理对象</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 具体方法的增强处理</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        transactionManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 开启事务</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 执行具体的业务方法</span>
            transactionManager<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提交事务</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            transactionManager<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 回滚事务</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            transactionManager<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 释放资源</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 事务管理器 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.tx.TransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- 代理对象回调器 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.tx.TransactionManagerCallback<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>target<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 真实对象 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.service.impl.MoneyServiceImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="aop概念"><a href="#aop概念" class="header-anchor">#</a> AOP概念</h2> <p>学习了动态代理，发现为N个service提供代理需要在XML配置N次。Spring的AOP能够解决这个问题。</p> <ul><li><strong>AOP</strong> (Aspect Oriented Programming) ：面向切面编程。</li> <li><strong>目的</strong>：能够将那些与业务无关，却为业务模块所共同调用的逻辑或责任（例如事务处理、日志管理、权限控制等）封装起来，便于减少系统的重复代码，降低模块间的耦合度，使系统容易扩展、更好的代码复用性，并有利于未来的可拓展性和可维护性。</li></ul> <p><img src="spring-AOP.png" alt="&quot;AOP&quot;"></p> <ul><li>Spring的AOP使用动态代理<strong>实现</strong>：
<ul><li>如果一个类实现了接口,那么Spring就使用 JDK的动态代理 完成AOP。</li> <li>如果一个类没有实现接口,那么Spring就是用 CGLib的动态代理 完成AOP。</li></ul></li> <li>AOP中的<strong>概念</strong>：
<ul><li><strong>切入点（Pointcut）</strong>：在哪些类，哪些方法上切入（<strong>where</strong>）。</li> <li><strong>增强（Advice）</strong>：方法执行的时机 (<strong>when</strong>：方法前/方法后/方法前后)，做什么 (<strong>what</strong>：增强的功能)。</li> <li><strong>切面（Aspect）</strong>：<strong>切面=切入点+通知</strong>，通俗点就是：在什么时机，什么地点，做什么增强。</li> <li><strong>织入（Weaving）</strong>：把切面加入到对象，并创建出代理对象的过程。（该过程由Spring来完成）。</li></ul></li></ul> <h2 id="aspectj"><a href="#aspectj" class="header-anchor">#</a> AspectJ</h2> <ul><li>AspectJ (语言)：表示在 哪些包下的 那些类的 哪些方法上 做切入。</li> <li><strong>语法</strong>（ ?：表示有无都可以）：</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code>execution(<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>修饰符</span><span class="token punctuation">&gt;</span></span>? <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>返回类型</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>声明类型</span><span class="token punctuation">&gt;</span></span>? <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>方法名</span><span class="token punctuation">&gt;</span></span>(<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>参数</span><span class="token punctuation">&gt;</span></span>) <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>异常</span><span class="token punctuation">&gt;</span></span>?)
</code></pre></div><p><img src="spring-AspectJ%E8%AF%AD%E6%B3%95.png" alt="&quot;AspectJ语法.png&quot;"></p> <h2 id="xml实现aop"><a href="#xml实现aop" class="header-anchor">#</a> XML实现AOP</h2> <ul><li>配置 aop命名空间
<ul><li>需要jar包：
<ul><li>spring-aop-5.1.7.RELEASE.jar</li> <li>aspectjweaver-1.9.4.jar</li></ul></li></ul></li></ul> <p><img src="spring-aop%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4.png" alt="&quot;aop命名空间&quot;"></p> <ul><li>配置AOP</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 事务管理器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.tx.TransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!--AOP配置--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--What：做什么做强--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--Where：在哪些地方增强--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txPointcut<span class="token punctuation">&quot;</span></span> 
                      <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>execution(* com.hao.service.*Service.*(..))<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--When：什么时机增强--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>beginTransaction<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txPointcut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-returning</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>commit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txPointcut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-throwing</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rollback<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txPointcut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>close<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txPointcut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>测试：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:applicationContext.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;moneyService&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">IMoneyService</span> moneyService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        moneyService<span class="token punctuation">.</span><span class="token function">transAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>结果</strong></p> <p>开启事务
A转出1000
B转入1000
提交事务
释放资源</p></blockquote> <h2 id="aop的各种增强"><a href="#aop的各种增强" class="header-anchor">#</a> AOP的各种增强</h2> <p><img src="spring-AOP%E5%90%84%E7%A7%8D%E5%A2%9E%E5%BC%BA.png" alt="&quot;AOP的各种增强&quot;"></p> <p><img src="spring-AOP%E5%A2%9E%E5%BC%BA%E6%96%B9%E6%B3%95%E5%AF%B9%E7%85%A7.png" alt="&quot;AOP增强方法对照&quot;"></p> <ul><li>注意：
<ul><li>如果使用 环绕增强，就不要出现前面的增强，否则造成重复。</li> <li>异常增强的接收类型是 <code>Throwable</code>，
XML中<code>throwing=&quot;e&quot;</code>值 由具体增强类中的 异常增强方法的形参名决定。</li></ul></li></ul> <h2 id="注解实现aop"><a href="#注解实现aop" class="header-anchor">#</a> 注解实现AOP</h2> <h3 id="aspect"><a href="#aspect" class="header-anchor">#</a> <code>@Aspect</code></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 相当于 &lt;aop:aspect  ref=&quot;transactionManager&quot;&gt;</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">&quot;transactionManager&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionManager</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="pointcut"><a href="#pointcut" class="header-anchor">#</a> <code>@Pointcut</code></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/* 相当于 
&lt;aop:pointcut id=&quot;txPointcut&quot; expression=&quot;execution(* com.hao.service.*Service.*(..))&quot;/&gt;
*/</span>
<span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.hao.service.*Service.*(..))&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">txPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//空方法 }</span>
</code></pre></div><h3 id="before"><a href="#before" class="header-anchor">#</a> <code>@Before</code></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 相当于 &lt;aop:before method=&quot;beginTransaction&quot; pointcut-ref=&quot;txPointcut&quot;/&gt;</span>
<span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="afterreturning"><a href="#afterreturning" class="header-anchor">#</a> <code>@AfterReturning</code></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 相当于 &lt;aop:after-returning method=&quot;commit&quot; pointcut-ref=&quot;txPointcut&quot;/&gt;</span>
<span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="afterthrowing"><a href="#afterthrowing" class="header-anchor">#</a> <code>@AfterThrowing</code></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 相当于 &lt;aop:after-throwing method=&quot;rollback&quot; throwing=&quot;e&quot; pointcut-ref=&quot;txPointcut&quot;/&gt;</span>
<span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="after"><a href="#after" class="header-anchor">#</a> <code>@After</code></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 相当于 &lt;aop:after method=&quot;close&quot; pointcut-ref=&quot;txPointcut&quot;/&gt;</span>
<span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="around"><a href="#around" class="header-anchor">#</a> <code>@Around</code></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 相当于 &lt;aop:around method=&quot;arround&quot; pointcut-ref=&quot;txPointcut&quot;/&gt;</span>
<span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">arround</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token comment">// Spring自动注入 ProceedingJoinPoint对象。</span>
<span class="token comment">// pjp.proceed()；	返回被增强方法执行的结果 </span>
</code></pre></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--扫描包找到 TransactionManager，告诉Spring容器去管理这个bean --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.tx<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!--AOP自动代理：自动为spring容器中那些配置 @AspectJ切面的bean创建代理，织入切面。--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">&quot;transactionManager&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionManager</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.hao.service.*Service.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">txPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;开启事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;提交事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;回滚事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;释放资源&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;txPointcut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">arround</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">rollback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>注意：
<ul><li>如果使用 @Around，就不要用上面的增强时机的注解。</li> <li>增强时机的注解，如 <code>@Around(&quot;txPointcut()&quot;)</code>，value=&quot;txPointcut()&quot;，千万不要漏掉&quot;()&quot;。</li></ul></li></ul> <br> <h1 id="spring支持jdbc"><a href="#spring支持jdbc" class="header-anchor">#</a> Spring支持JDBC</h1> <ul><li><p>Spring提供的JDBC模板类：</p> <ul><li><code>org.springframework.jdbc.core.JdbcTemplate</code></li> <li><code>org.springframework.jdbc.core.support.JdbcDaoSupport</code></li></ul></li> <li><p>准备：</p> <ul><li>jar包：
<ul><li>MySQL驱动包</li> <li>spring-jdbc-5.1.7.RELEASE.jar</li></ul></li> <li>实体类</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>DAO接口</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IJobDao</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Job</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Job</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Job</span><span class="token punctuation">&gt;</span></span> <span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">Job</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="jdbctemplate"><a href="#jdbctemplate" class="header-anchor">#</a> JdbcTemplate</h2> <p><code>org.springframework.jdbc.core.JdbcTemplate</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JobDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IJobDao</span><span class="token punctuation">{</span>

    <span class="token comment">// Spring提供的 JDBC模板类</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setDataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> dataSource <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Job</span> job<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        PreparedStatementCreatorFactory factory = new PreparedStatementCreatorFactory(&quot;INSERT INTO `job`(`name`) VALUES (?)&quot;, Types.VARCHAR);</span>
<span class="token comment">//        factory.setReturnGeneratedKeys(true);</span>
<span class="token comment">//        PreparedStatementCreator psc = factory.newPreparedStatementCreator(new Object[]{job.getName()});</span>
<span class="token comment">//        KeyHolder keyHolder = new GeneratedKeyHolder();</span>
<span class="token comment">//        this.jdbcTemplate.update(psc, keyHolder);</span>
<span class="token comment">//        long id = keyHolder.getKey().longValue();</span>
<span class="token comment">//        System.out.println(id);</span>
<span class="token comment">//        job.setId(id);</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO `job`(`name`) VALUES (?)&quot;</span><span class="token punctuation">,</span> job<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM `job` WHERE `id`=?&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Job</span> job<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;UPDATE `job` SET `name`=? WHERE `id`=?&quot;</span><span class="token punctuation">,</span> job<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> job<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Job</span><span class="token punctuation">&gt;</span></span> <span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM `job`&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Job</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Job</span> <span class="token function">mapRow</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> rowNum<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
                <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Job</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                job<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                job<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> job<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Job</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Job</span><span class="token punctuation">&gt;</span></span> jobs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM `job` WHERE `id`=?&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Job</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Job</span> <span class="token function">mapRow</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> rowNum<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
                <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Job</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                job<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                job<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> job<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jobs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> jobs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jobDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.dao.impl.JobDaoImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="jdbcdaosupport"><a href="#jdbcdaosupport" class="header-anchor">#</a> JdbcDaoSupport</h2> <p><code>org.springframework.jdbc.core.support.JdbcDaoSupport</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JobDaoImpl</span> <span class="token keyword">extends</span> <span class="token class-name">JdbcDaoSupport</span> <span class="token keyword">implements</span> <span class="token class-name">IJobDao</span><span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Job</span> job<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// JdbcTemplate : this.jdbcTemplate.update(...);</span>
        <span class="token comment">// JdbcDaoSupport : 将 this.jdbcTemplate 改为 super.getJdbcTemplate()。</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO `job`(`name`) VALUES (?)&quot;</span><span class="token punctuation">,</span> job<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jobDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.dao.impl.JobDaoImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="获取自增主键"><a href="#获取自增主键" class="header-anchor">#</a> 获取自增主键</h2> <ul><li>使用update的参数列表：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatementCreator</span> psc<span class="token punctuation">,</span> <span class="token class-name">KeyHolder</span> generatedKeyHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>使用：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
创建 PreparedStatementCreator 的工厂类，
构造器：PreparedStatementCreatorFactory(String sql, int... types)
	sql：目标SQL；	
	types：SQL占位符？的类型，有多少个？就对应多少个type。
			java.sql.Types 包含这些类型。
*/</span>
<span class="token class-name">PreparedStatementCreatorFactory</span> factory <span class="token operator">=</span> 
    <span class="token keyword">new</span> <span class="token class-name">PreparedStatementCreatorFactory</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO `job`(`name`) VALUES (?)&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span>VARCHAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置返回自增的主键</span>
factory<span class="token punctuation">.</span><span class="token function">setReturnGeneratedKeys</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 构建 PreparedStatementCreator对象，并且设置占位符对应的参数</span>
<span class="token class-name">PreparedStatementCreator</span> psc <span class="token operator">=</span> 
    factory<span class="token punctuation">.</span><span class="token function">newPreparedStatementCreator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>job<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建 GeneratedKeyHolder对象，用于保存返回的主键</span>
<span class="token class-name">KeyHolder</span> keyHolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratedKeyHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 执行DML操作</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>psc<span class="token punctuation">,</span> keyHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 取得返回的主键</span>
<span class="token keyword">long</span> id <span class="token operator">=</span> keyHolder<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置主键到Job对象</span>
job<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><br> <h1 id="spring对事务的支持"><a href="#spring对事务的支持" class="header-anchor">#</a> Spring对事务的支持</h1> <p><img src="spring-%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB.png" alt="&quot;事务的隔离级别&quot;"></p> <h2 id="事务管理的主要接口"><a href="#事务管理的主要接口" class="header-anchor">#</a> 事务管理的主要接口</h2> <ul><li><code>org.springframework.transaction.PlatformTransactionManager</code>
根据TransactionDefinition提供的事务属性配置信息，创建事务。</li></ul> <p><img src="spring-PlatformTransactionManager%E5%AE%9E%E7%8E%B0%E5%9B%BE.png" alt="&quot;PlatformTransactionManager实现图&quot;"></p> <p><img src="spring-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8.png" alt="&quot;事务管理器&quot;"></p> <ul><li><code>org.springframework.transaction.TransactionDefinition</code>
封装事务的隔离级别和超时时间，是否为只读事务和事务的隔离级别和传播规则等事务属性，可通过XML配置具体信息。</li></ul> <p><img src="spring-%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A7%84%E5%88%99%E7%B1%BB%E5%9E%8B.png" alt="&quot;事务传播规则类型&quot;"></p> <ul><li><code>org.springframework.transaction.TransactionStatus</code>
封装了事务的具体运行状态。如，是否是新开启事务，是否已经提交事务，设置当前事务为rollback-only等。</li></ul> <h2 id="声明式事务管理"><a href="#声明式事务管理" class="header-anchor">#</a> 声明式事务管理</h2> <h3 id="xml配置-2"><a href="#xml配置-2" class="header-anchor">#</a> XML配置</h3> <ul><li>jar包：
<ul><li>spring-tx-5.1.7.RELEASE.jar</li> <li>根据事务管理器图，导入：spring-jdbc-5.1.7.RELEASE.jar 或 spring-orm-5.1.7.RELEASE.jar。</li></ul></li> <li>引入 <strong>tx命名空间</strong>：</li></ul> <p><img src="spring-tx%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4.png" alt="&quot;tx命名空间&quot;"></p> <ul><li>配置事务：</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--配置事务管理器--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> 
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--When：事务管理的时机(环绕增强)--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>被事务管理的方法名<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--Where：事务管理的地方--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txPointcut<span class="token punctuation">&quot;</span></span> 
                  <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>execution(* com.hao.service.*Service.*(..))<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txPointcut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>事务方法的属性细节</li></ul> <p><img src="spring-%E4%BA%8B%E5%8A%A1%E6%96%B9%E6%B3%95%E5%B1%9E%E6%80%A7%E7%BB%86%E8%8A%82.png" alt="&quot;事务方法的属性细节&quot;"></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- CRUD通用的环绕增强 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--查询方法--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>get*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>list*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>find*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>query*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--其他方法--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="注解配置-2"><a href="#注解配置-2" class="header-anchor">#</a> 注解配置</h3> <p><strong>@Transactional</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><p><img src="spring-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE.png" alt="&quot;@Transactional&quot;"></p> <br> <h1 id="spring注解驱动开发"><a href="#spring注解驱动开发" class="header-anchor">#</a> Spring注解驱动开发</h1> <h2 id="组件注册"><a href="#组件注册" class="header-anchor">#</a> 组件注册</h2> <h3 id="configuration"><a href="#configuration" class="header-anchor">#</a> @Configuration</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> 
        <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token class-name">MainConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> ctx<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 获取已定义的bean (包括扫描进来注册的bean)</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> beanNames <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="bean-3"><a href="#bean-3" class="header-anchor">#</a> @Bean</h3> <ul><li>如果 <strong>@Bean</strong> 配置了属性<strong>name</strong>，id的值就是name，否则默认就是方法名为id。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Tony&quot;</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="componentscan"><a href="#componentscan" class="header-anchor">#</a> @ComponentScan</h3> <ul><li>扫描包的类，将贴上@Component注解的类注册为bean。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.hao.spring&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>excludeFilters：排除某些类。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>
        basePackages <span class="token operator">=</span> <span class="token string">&quot;com.hao.spring&quot;</span><span class="token punctuation">,</span>
    	<span class="token comment">// 过滤类型为注解，排除@Service的类</span>
        excludeFilters <span class="token operator">=</span> <span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>
            type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token keyword">class</span>
        <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>includeFilters：只包含某些类。( <strong>useDefaultFilters = false</strong> 才会生效。 )</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>
        basePackages <span class="token operator">=</span> <span class="token string">&quot;com.hao.spring&quot;</span><span class="token punctuation">,</span>
        useDefaultFilters <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    	<span class="token comment">// 过滤类型为注解，只包含@Controller的类</span>
        includeFilters <span class="token operator">=</span> <span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>
            type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span>
        <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="componentscans"><a href="#componentscans" class="header-anchor">#</a> @ComponentScans</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScans</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.hao.spring.dao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.hao.spring.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.hao.spring.controller&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果是JDK8，可以使用重复注解。即在 类MainConfig 贴上多个 @ComponentScan 注解。</p> <h3 id="filtertype"><a href="#filtertype" class="header-anchor">#</a> FilterType</h3> <table><thead><tr><th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>ANNOTATION</td> <td>注解（根据@Component, @Repository, @Service, @Controller 不同类型而过滤）</td></tr> <tr><td>ASSIGNABLE_TYPE</td> <td>指定类型（例：指定Xxx类，只会注册Xxx类(包括实现类，子类)为bean）</td></tr> <tr><td>ASPECTJ</td> <td>AspectJ 表达式</td></tr> <tr><td>REGEX</td> <td>正则表达式</td></tr> <tr><td>CUSTOM</td> <td>自定义规则</td></tr></tbody></table> <ul><li>CUSTOM (自定义规则)：实现<code>org.springframework.core.type.filter.TypeFilter</code>接口。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTypeFilter</span> <span class="token keyword">implements</span> <span class="token class-name">TypeFilter</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 自定义的过滤规则
     * @param metadataReader    读取到的当前正在扫描的类的信息
     * @param metadataReaderFactory     可以获取到 basePackages路径下 其他类的信息
     * @return  true:注册bean		false：跳过
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">MetadataReader</span> metadataReader<span class="token punctuation">,</span> <span class="token class-name">MetadataReaderFactory</span> metadataReaderFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        metadataReader<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// </span>
        metadataReader<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// </span>
        metadataReader<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// </span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 使用</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">MyTypeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>MetadataReader
| 方法                  | 说明                     |
| --------------------- | ------------------------ |
| getAnnotationMetadata | 当前扫描的类的注解的信息 |
| getClassMetadata      | 当前扫描的类的信息       |
| getResource           | 当前扫描的类的路径       |</li></ul> <h3 id="scope-2"><a href="#scope-2" class="header-anchor">#</a> @Scope</h3> <ul><li>scopeName : <strong>singleton</strong> (默认)，<strong>prototype</strong>，<strong>request</strong>，<strong>session</strong>。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>scopeName <span class="token operator">=</span> <span class="token string">&quot;prototype&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Tony&quot;</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="lazy"><a href="#lazy" class="header-anchor">#</a> @Lazy</h3> <ul><li><p>bean默认是单例模式(singleton)，容器创建完成就创建后这些实例。</p></li> <li><p>懒加载：容器创建好先不创建这些实例，等到第一次创建对象，再创建这个bean实例。</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Lazy</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Tony&quot;</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="conditional"><a href="#conditional" class="header-anchor">#</a> @Conditional</h3> <ul><li>满足条件才将注册bean。
<ul><li>贴在<strong>类</strong>上：满足条件注册类中的所有bean。</li> <li>贴在<strong>方法</strong>上：满足条件注册这个bean。</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">MyCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Tony&quot;</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCondition</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     *  自定义的匹配规则
     * @param conditionContext  判断条件的上下文
     * @param annotatedTypeMetadata     访问特定类的注解的接口，不需要加载该类
     * @return  true:注册bean     false：跳过
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> conditionContext<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> annotatedTypeMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 匹配规则</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>ConditionContext</li></ul> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>getBeanFactory</td> <td>获取BeanFactory</td></tr> <tr><td>getEnvironment</td> <td>获取环境（例：os.name[系统名字]）</td></tr> <tr><td>getResourceLoader</td> <td>获取资源加载器</td></tr> <tr><td>getClassLoader</td> <td>获取类加载器</td></tr></tbody></table> <h3 id="import-2"><a href="#import-2" class="header-anchor">#</a> @Import</h3> <ul><li>@Import( {组件} )：快速导入组件。容器会自动注册这些组件，id为组件的全限定类名。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token class-name">BookDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">BookService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>@Import( 自定义类 实现接口: <code>org.springframework.context.annotation.ImportSelector</code> )，
id为组件的全限定类名。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">MyImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">ImportSelector</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 导入组件
     * @param annotationMetadata    当前标注@Import的类的所有注解的信息
     * @return  组件的全限定类名数组
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不能返回null，会发生 NullPointerException</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>
                <span class="token class-name">BookDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">BookService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>@Import( 自定义类 实现接口: <code>org.springframework.context.annotation.ImportBeanDefinitionRegistrar</code> )，
id为组件的全限定类名。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">MyImportBeanDefinitionRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImportBeanDefinitionRegistrar</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 注册bean
     * @param annotationMetadata    当前标注@Import的类的所有注解的信息
     * @param beanDefinitionRegistry    BeanDefinition注册类(bean的注册器)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> beanDefinitionRegistry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// registerBeanDefinition( bean的id, bean的class(BeanDefinition的实现类) )</span>
        beanDefinitionRegistry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>
            <span class="token string">&quot;bookService&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">BookService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
BeanDefinition的实现类：
	方式一：
	new RootBeanDefinition( Class&lt;?&gt; beanClass )
	方式二：
	BeanDefinitionBuilder.rootBeanDefinition().getBeanDefinition( Class&lt;?&gt; beanClass )
*/</span>
</code></pre></div><h3 id="factorybean"><a href="#factorybean" class="header-anchor">#</a> FactoryBean</h3> <ul><li>配置 factoryBean (实现<code>org.springframework.beans.factory.FactoryBean</code>) ，在容器注册的是factoryBean 调用 getObject( ) 返回的bean。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ColorFactoryBean</span> <span class="token keyword">implements</span> <span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Color</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 获取bean
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Color</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取bean的类型
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * bean是否单例[ true:单例;   false:多例 ]
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ColorFactoryBean</span> <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ColorFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>getBean( <strong>id</strong> ) 获取到 bean。</li> <li>getBean( <strong>&amp;id</strong> ) 获取到 factoryBean。</li></ol> <div class="language-java extra-class"><pre class="language-java"><code>applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// class com.hao.spring.bean.Color</span>

applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// class com.hao.spring.factory.ColorFactoryBean</span>
</code></pre></div><h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <h3 id="bean-4"><a href="#bean-4" class="header-anchor">#</a> @Bean</h3> <ul><li>@Bean( initMethod=&quot;初始化方法&quot;, destroyMethod=&quot;销毁方法&quot; )</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// 要求Car的 init方法 和 destroy方法 必须是无参的。(异常任意抛)</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>initMethod <span class="token operator">=</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">,</span> destroyMethod <span class="token operator">=</span> <span class="token string">&quot;destroy&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="initializingbean"><a href="#initializingbean" class="header-anchor">#</a> InitializingBean</h3> <ul><li><code>org.springframework.beans.factory.InitializingBean</code> : 实现该接口的 afterPropertiesSet 方法, 定义初始化逻辑。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 初始化操作</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="disposablebean"><a href="#disposablebean" class="header-anchor">#</a> DisposableBean</h3> <ul><li><code>org.springframework.beans.factory.InitializingBean</code> : 实现该接口的 destroy 方法, 定义销毁逻辑。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 销毁操作</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="postconstruct"><a href="#postconstruct" class="header-anchor">#</a> @PostConstruct</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 初始化操作</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="predestroy"><a href="#predestroy" class="header-anchor">#</a> @PreDestroy</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PreDestroy</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 销毁操作</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="beanpostprocessor"><a href="#beanpostprocessor" class="header-anchor">#</a> BeanPostProcessor</h3> <ul><li><code>org.springframework.beans.factory.config.BeanPostProcessor</code> : 实现该接口。
<ul><li>重写 postProcessBeforeInitialization 方法 : 所有bean初始化方法之前的操作(构造器之后)。</li> <li>重写 postProcessAfterInitialization 方法 : 所有bena初始化方法之后的操作。</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>
	<span class="token comment">/**
	 * 如果返回null，底层接收还是原来的bean。
	 * 如果返回bean的包装类，底层接收到的bean就是返回的包装类
	 */</span>	
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 所有bean初始化前的操作</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 如果返回null，底层接收还是原来的bean。
	 * 如果返回bean的包装类，底层接收到的bean就是返回的包装类
	 */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 所有bean初始化后的操作。</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>总结：方法的先后顺序</p> <p><strong>构造器</strong>
BeanPostProcessor.<strong>postProcessBeforeInitialization</strong> <strong>@PostConstruct</strong>
InitializingBean.<strong>afterPropertiesSet</strong>
@Bean( <strong>initMethod</strong>=&quot;&quot; )
BeanPostProcessor.<strong>postProcessAfterInitialization</strong>
......
<strong>@PreDestroy</strong>
DisposableBean.<strong>destroy</strong>
@Bean( <strong>destroyMethod</strong>=&quot;&quot; )</p></blockquote> <h2 id="属性赋值"><a href="#属性赋值" class="header-anchor">#</a> 属性赋值</h2> <h3 id="value"><a href="#value" class="header-anchor">#</a> @Value</h3> <ul><li>@Value( 字符串 )
<ul><li>基本数值</li> <li>SpEL : #{ }</li> <li>${ } : 取出配置文件[properties]的值(在运行环境变量的值)</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;RED&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="propertysource"><a href="#propertysource" class="header-anchor">#</a> @PropertySource</h3> <ul><li>@PropertySource 可以加载多个properties文件。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;classpath:color.properties&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Color</span> <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${color.name}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>ApplicationContext对象.getEnvironment().getProperty( key ) : 获取到properties文件的value。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Environment</span> environment <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;color.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//BLUE</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="propertysources"><a href="#propertysources" class="header-anchor">#</a> @PropertySources</h3> <ul><li>@PropertySources 配置多个@PropertySource，也可以加载多个properties文件。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@PropertySources</span><span class="token punctuation">(</span>
	<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:color.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:car.properties&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="自动装配-2"><a href="#自动装配-2" class="header-anchor">#</a> 自动装配</h2> <h3 id="autowired-2"><a href="#autowired-2" class="header-anchor">#</a> @Autowired</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Color</span> color<span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// @Autowired 标注在 @Bean方法 或 参数，可以省略不写。默认自动从容器注入bean。</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Color</span> <span class="token function">color</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@Autowired</span> <span class="token class-name">Red</span> red<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span>red<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="resource-2"><a href="#resource-2" class="header-anchor">#</a> @Resource</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Color</span> color<span class="token punctuation">;</span>
</code></pre></div><h3 id="primary"><a href="#primary" class="header-anchor">#</a> @Primary</h3> <ul><li>被 @Primary 标注的bean会优先注入。但是若指定bean名，还是按照bean名去注入。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token keyword">public</span> <span class="token class-name">Color</span> <span class="token function">color1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token string">&quot;color1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="inject"><a href="#inject" class="header-anchor">#</a> @Inject</h3> <ul><li>功能和 @Autowired 一样。(需要导入依赖)</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Inject</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Color</span> color<span class="token punctuation">;</span>
</code></pre></div><h3 id="xxxaware"><a href="#xxxaware" class="header-anchor">#</a> XxxAware</h3> <ul><li>自定义组件想要使用Spring容器底层的一些组件(ApplicationContext, BeanFactory)：
自定义组件实现 XxxAware接口。容器在创建自定义组件对象时，会调用接口中的方法注入相关组件。</li></ul> <p><code>org.springframework.beans.factory.Aware</code>的子接口 <code>XxxAware</code> .</p> <p><img src="spring-XxxAware.png" alt="&quot;XxxAware&quot;"></p> <ul><li><p>bean实现 XxxAware 接口，Spring容器有对应的 BeanPostProcessor实现类，在初始化bean前执行 XxxAware接口的方法。</p></li> <li><p><code>org.springframework.context.ApplicationContextAware</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationContextAware</span> <span class="token keyword">extends</span> <span class="token class-name">Aware</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>

    <span class="token comment">// bean初始化前，容器将 applicationContext 注入bean</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="profile"><a href="#profile" class="header-anchor">#</a> @Profile</h3> <ul><li><p>指定组件在哪个环境才能被注册到容器中。不指定，任何环境都能注册这个组件。</p></li> <li><p>@Profile( &quot;default&quot; ) : 默认运行环境为 default。@Profile(&quot;default&quot;)可以不写。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 不写@Profile，默认就是@Profile(&quot;default&quot;)，无论什么运行环境，都会被注册为bean。</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>@Profile( 指定环境 ) : 被标注组件只有符合指定的环境才会被注册为bean。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Color</span> <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>@Profile( 指定环境 ) 标注在<strong>配置类</strong>上。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 如果环境不是test，这个类的任何组件(不管组件的@Profile)都不能被容器注册。</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>指定运行环境：</p> <ul><li><p>虚拟机参数指定。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>-Dspring.profiles.active<span class="token operator">=</span>test
</code></pre></div></li> <li><p>容器初始化指定。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 如果类型是ApplicationContext不能进行下面的操作</span>
<span class="token class-name">AnnotationConfigApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setActiveProfiles</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;dev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 可以设置多个环境</span>
ctx<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">MainConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <h2 id="aop-2"><a href="#aop-2" class="header-anchor">#</a> AOP</h2> <ul><li><p>业务类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Calculator</span> <span class="token punctuation">{</span>
    <span class="token comment">// 业务方法</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> a<span class="token punctuation">,</span> <span class="token class-name">Integer</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Calculator.div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>切面类</p></li></ul> <h3 id="aspect-2"><a href="#aspect-2" class="header-anchor">#</a> @Aspect</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogAspect</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="pointcut-2"><a href="#pointcut-2" class="header-anchor">#</a> @Pointcut</h3> <ul><li>引用：方法的全限定名。如：xxx包.pointcut()。同类可以直接：pointcut()。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution( * com.hao.spring.bean.Calculator.*(..) )&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="before-2"><a href="#before-2" class="header-anchor">#</a> @Before</h3> <ul><li><code>JoinPoint</code>参数 必须是参数列表的第一位。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;pointcut()&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logBefore</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// joinPoint.getSignature()   获取方法签名</span>
    <span class="token class-name">String</span> methodName <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取方法名</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 获取方法的参数</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">&quot;执行方法: &quot;</span> <span class="token operator">+</span> methodName <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="after-2"><a href="#after-2" class="header-anchor">#</a> @After</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;pointcut()&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logAfter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">&quot;执行结束&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="afterreturning-2"><a href="#afterreturning-2" class="header-anchor">#</a> @AfterReturning</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;pointcut()&quot;</span><span class="token punctuation">,</span> returning <span class="token operator">=</span> <span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logAfterReturning</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Object</span> result<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">&quot;执行正常, 返回结果: &quot;</span> <span class="token operator">+</span> result <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="afterthrowing-2"><a href="#afterthrowing-2" class="header-anchor">#</a> @AfterThrowing</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;pointcut()&quot;</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">&quot;exception&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logAfterThrowing</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">&quot;执行出现异常: &quot;</span> <span class="token operator">+</span> exception <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="around-2"><a href="#around-2" class="header-anchor">#</a> @Around</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pointcut()&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// Before</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// AfterReturning</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// AfterThrowing</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">// After</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>配置类</li></ul> <h3 id="enableaspectjautoproxy"><a href="#enableaspectjautoproxy" class="header-anchor">#</a> @EnableAspectJAutoProxy</h3> <ul><li>相当于 <code>&lt;aop:aspectj-autoproxy/&gt;</code> .</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">LogAspect</span> <span class="token function">logAspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogAspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Calculator</span> <span class="token function">calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <h3 id="datasource"><a href="#datasource" class="header-anchor">#</a> DataSource</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 数据源</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">DruidDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/ssm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="platformtransactionmanager"><a href="#platformtransactionmanager" class="header-anchor">#</a> PlatformTransactionManager</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 事务管理器</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">PlatformTransactionManager</span> <span class="token function">transactionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="enabletransactionmanagement"><a href="#enabletransactionmanagement" class="header-anchor">#</a> @EnableTransactionManagement</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 相当于 &lt;tx:annotation-driven/&gt;</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TxConfig</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="transactional"><a href="#transactional" class="header-anchor">#</a> @Transactional</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">UserService</span><span class="token punctuation">{</span>
    <span class="token comment">// 业务方法加上事务</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        userDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h2> <h3 id="beanfactorypostprocessor"><a href="#beanfactorypostprocessor" class="header-anchor">#</a> BeanFactoryPostProcessor</h3> <ul><li><code>org.springframework.beans.factory.config.BeanFactoryPostProcessor</code> 接口 : BeanFactory的后置处理器。在BeanFactory标准初始化之后调用，来定制和修改BeanFactory的内容。</li> <li>所有的<strong>bean定义信息已经保存加载到BeanFactory</strong>，但是bean的实例还未创建。</li> <li>在 <strong>bean创建对象之前</strong>，调用BeanFactoryPostProcessor实现类的方法，执行操作。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBeanFactoryPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanFactoryPostProcessor</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定制与修改 beanFactory</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="beandefinitionregistrypostprocessor"><a href="#beandefinitionregistrypostprocessor" class="header-anchor">#</a> BeanDefinitionRegistryPostProcessor</h3> <ul><li>BeanDefinitionRegistryPostProcessor是 BeanFactoryPostProcessor 的子接口。</li> <li>在所有<strong>bean定义信息将要被加载到BeanFactory</strong>，同样bean实例还未创建。</li> <li><strong>优先于BeanFactoryPostProcessor执行</strong>。利用BeanDefinitionRegistryPostProcessor给容器中再额外添加一些组件。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBeanDefinitionRegistryPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanDefinitionRegistryPostProcessor</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postProcessBeanDefinitionRegistry</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token comment">// registry：bean的注册中心</span>
        <span class="token comment">// 可以注册bean的信息，如：registry.registerBeanDefinition( beanId, beanClass );</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定制与修改 beanFactory</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>执行顺序</strong>：</p> <p>所有 BeanDefinitionRegistryPostProcessor.<strong>postProcessBeanDefinitionRegistry</strong></p> <p>所有 BeanDefinitionRegistryPostProcessor.<strong>postProcessBeanFactory</strong></p> <p>所有 BeanFactoryPostProcessor.<strong>postProcessBeanFactory</strong></p></blockquote> <h3 id="applicationlistener"><a href="#applicationlistener" class="header-anchor">#</a> ApplicationListener</h3> <ul><li><p><code>org.springframework.context.ApplicationListener</code> : 监听容器中发布的事件。</p> <ul><li><code>ApplicationListener&lt;E extends ApplicationEvent&gt;</code> : 监听 ApplicationEvent 及其下面的子事件。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
 * 写一个监听器（ApplicationListener实现类）来监听某个事件（ApplicationEvent及其子事件）。
 * 只要容器中有相关事件的发布，我们就能监听到这个事件。
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplicationListener</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;发布的事件: &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 发布事件：publishEvent(ApplicationEvent event)</span>
applicationContext<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApplicationEvent</span><span class="token punctuation">(</span> <span class="token class-name">Object</span> obj <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>org.springframework.context.ApplicationEvent</code> : 事件对象。</p> <ul><li><strong>ContextRefreshedEvent</strong>：容器刷新完成（所有bean都完全创建）会发布这个事件。</li> <li><strong>ContextClosedEvent</strong>：关闭容器会发布这个事件。</li></ul></li></ul> <p><img src="spring-AppliationEvent.png" alt="&quot;AppliationEvent&quot;"></p> <h3 id="eventlistener"><a href="#eventlistener" class="header-anchor">#</a> @EventListener</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@EventListener</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">ApplicationEvent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 收到 ApplicationEvent事件及子事件</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="smartinitializingsingleton"><a href="#smartinitializingsingleton" class="header-anchor">#</a> SmartInitializingSingleton</h3> <ul><li>在所有单实例bean初始化完成后，获取所有创建好的单实例bean，判断是否实现 <code>org.springframework.beans.factory.SmartInitializingSingleton</code> 接口，
是：就调用bean的 <strong>afterSingletonsInstantiated</strong> 方法。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SmartInitializingSingleton</span> <span class="token punctuation">{</span>

	<span class="token keyword">void</span> <span class="token function">afterSingletonsInstantiated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.04a292d2.js" defer></script><script src="/assets/js/2.4fad892d.js" defer></script><script src="/assets/js/10.8e879de9.js" defer></script>
  </body>
</html>
