<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SringMVC | Hao-Blog</title>
    <meta name="description" content="专注互联网技术">
    
    
    <link rel="preload" href="/assets/css/0.styles.595b60ed.css" as="style"><link rel="preload" href="/assets/js/app.04a292d2.js" as="script"><link rel="preload" href="/assets/js/2.4fad892d.js" as="script"><link rel="preload" href="/assets/js/12.013bff42.js" as="script"><link rel="prefetch" href="/assets/js/10.8e879de9.js"><link rel="prefetch" href="/assets/js/11.b217e124.js"><link rel="prefetch" href="/assets/js/13.3cdff795.js"><link rel="prefetch" href="/assets/js/14.b5ab60e6.js"><link rel="prefetch" href="/assets/js/15.50bec27e.js"><link rel="prefetch" href="/assets/js/16.c16c9f53.js"><link rel="prefetch" href="/assets/js/3.30ead0c9.js"><link rel="prefetch" href="/assets/js/4.c0014c96.js"><link rel="prefetch" href="/assets/js/5.811e20e2.js"><link rel="prefetch" href="/assets/js/6.dba0d004.js"><link rel="prefetch" href="/assets/js/7.35746c6c.js"><link rel="prefetch" href="/assets/js/8.6b384213.js"><link rel="prefetch" href="/assets/js/9.9b657d40.js">
    <link rel="stylesheet" href="/assets/css/0.styles.595b60ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hao-Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SringMVC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/SpringMVC/SpringMVC.html#介绍" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#springmvc-入门程序" class="sidebar-link">SpringMVC 入门程序</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#url映射方式" class="sidebar-link">URL映射方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#beannameurl" class="sidebar-link">BeanNameURL</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#注解" class="sidebar-link">注解</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#全注解" class="sidebar-link">全注解</a></li></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#静态资源的处理" class="sidebar-link">静态资源的处理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#传参方式" class="sidebar-link">传参方式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#类型转换器" class="sidebar-link">类型转换器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#中文乱码问题" class="sidebar-link">中文乱码问题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#拦截器" class="sidebar-link">拦截器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#传值方式" class="sidebar-link">传值方式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#文件上传" class="sidebar-link">文件上传</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#文件下载" class="sidebar-link">文件下载</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#常用注解" class="sidebar-link">常用注解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#requestmapping" class="sidebar-link">@RequestMapping</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#requestparam" class="sidebar-link">@RequestParam</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#pathvariable" class="sidebar-link">@PathVariable</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#modelattribute" class="sidebar-link">@ModelAttribute</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#cookievalue" class="sidebar-link">@CookieValue</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#sessionattribute" class="sidebar-link">@SessionAttribute</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#sessionattributes" class="sidebar-link">@SessionAttributes</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#responsebody" class="sidebar-link">@ResponseBody</a></li></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#区别struts2" class="sidebar-link">区别Struts2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#源码解析" class="sidebar-link">源码解析</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#区别-springmvc-与-struts2" class="sidebar-link">区别: springMVC 与 Struts2</a></li></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#纯注解版" class="sidebar-link">纯注解版</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#servlet-3-0-新特性" class="sidebar-link">Servlet 3.0 新特性</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#servletcontainerinitializer" class="sidebar-link">ServletContainerInitializer</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#handlestypes" class="sidebar-link">@HandlesTypes</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#异步请求" class="sidebar-link">异步请求</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#整合springmvc" class="sidebar-link">整合SpringMVC</a></li></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#定制springmvc" class="sidebar-link">定制SpringMVC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#enablewebmvc" class="sidebar-link">@EnableWebMvc</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#webmvcconfigurer" class="sidebar-link">WebMvcConfigurer</a></li></ul></li><li><a href="/Java/SpringMVC/SpringMVC.html#异步请求-2" class="sidebar-link">异步请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#callable" class="sidebar-link">Callable</a></li><li class="sidebar-sub-header"><a href="/Java/SpringMVC/SpringMVC.html#deferredresult" class="sidebar-link">DeferredResult</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sringmvc"><a href="#sringmvc" class="header-anchor">#</a> SringMVC</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <ul><li><p>Spring MVC是基于MVC模式的一个框架, 它解决WEB开发中常见的问题(参数接收、文件上传、表单验证、国际化、等等), 而且使用简单, 与spring无缝集成.</p></li> <li><p>Spring MVC是Spring提供的一个强大而灵活的web框架. 借助于注解, Spring MVC提供了几乎是POJO的开发模式, 使得控制器的开发和测试更加简单. 这些控制器一般不直接处理请求, 而是将其委托给Spring上下文中的其他bean, 通过Spring的依赖注入功能, 这些bean被注入到控制器中.</p></li> <li><p>Spring MVC主要由 DispatcherServlet、处理器映射[找控制器]、适配器[调用控制器的方法]、控制器[业务]、视图解析器、视图组成.</p></li></ul> <h2 id="springmvc-入门程序"><a href="#springmvc-入门程序" class="header-anchor">#</a> SpringMVC 入门程序</h2> <p>访问: localhost/hello, 后台打印 Hello World, 跳转到 hello.jsp.</p> <hr> <ol><li>导入相关jar包</li></ol> <ul><li>spring-beans-4.1.2.RELEASE.jar</li> <li>spring-context-4.1.2.RELEASE.jar</li> <li>spring-core-4.1.2.RELEASE.jar</li> <li>spring-expression-4.1.2.RELEASE.jar</li> <li>spring-web-4.1.2.RELEASE.jar</li> <li>spring-webmvc-4.1.2.RELEASE.jar</li></ul> <hr> <ol start="2"><li>web.xml 配置分发器</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>springMVC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>  
        org.springframework.web.servlet.DispatcherServlet  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>springMVC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>启动服务器, 访问 localhost/hello, 报错<br> <img src="springmvc-CouldNotOpenServletContextResource.png" alt="&quot;异常&quot;"></p> <blockquote><p>需要一个配置文件: /WEB-INF/springMVC-servelt.xml<br>
(这个文件就是spring框架的applicationContext.xml, 改名为springMVC-servlet.xml. 这个名字其实是<code>{servlet-name}-servlet.xml</code>)</p></blockquote> <hr> <ol start="3"><li>编写 <code>HelloController</code>类, 实现 <code>org.springframework.web.servlet.mvc.Controller</code> 接口, 重写 handleRequest 方法.</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token keyword">implements</span> <span class="token class-name">Controller</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;/hello.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <ol start="4"><li>配置这个 Controller 到 application-mvc.xml.</li></ol> <p><img src="springmvc-HelloController%E9%85%8D%E7%BD%AE.png" alt="&quot;配置 HelloController&quot;"></p> <hr> <ol start="5"><li>访问: localhost/hello</li></ol> <p><img src="springmvc-HelloController%E7%BB%93%E6%9E%9C.png" alt="&quot;HelloController 结果&quot;"></p> <blockquote><ul><li>访问: localhost/hello.abcde 也能访问到handleRequest()这个方法.</li> <li>原因: springMVC是 匹配名字 而不是匹配路径, 但匹配不一定是精确匹配.</li> <li>默认:<br>
如果找到 hello.abcde 就精确匹配, 直接进入这个方法.<br>
如果找不到就处理成 hello.* 按hello去找方法.</li></ul></blockquote> <hr> <ol start="6"><li>配置细节</li></ol> <ul><li>启动服务器时,springMVC不会去加载{servlet-name}-servlet.xml, 而是要等到第一次访问才会去加载, 这样第一次访问的体验不好, 所以我们会这样配置.</li></ul> <p><img src="springmvc-%E5%90%AF%E5%8A%A8%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="&quot;启动加载配置文件&quot;"></p> <ul><li>DispatcherServlet 默认找 {servlet-name}-servlet.xml, 我们一般会把配置文件放到 resources目录, 让框架找到这个文件.</li></ul> <p><img src="springmvc-%E5%8A%A0%E8%BD%BD%E6%8C%87%E5%AE%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="&quot;加载指定配置文件&quot;"></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>springMVC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
        org.springframework.web.servlet.DispatcherServlet
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>classpath:spingmvc.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><br> <h2 id="url映射方式"><a href="#url映射方式" class="header-anchor">#</a> URL映射方式</h2> <h3 id="beannameurl"><a href="#beannameurl" class="header-anchor">#</a> BeanNameURL</h3> <p>BeanNameURL方式 来配置前台请求映射哪个处理类. (很少用)
<img src="springmvc-HelloController%E9%85%8D%E7%BD%AE.png" alt="&quot;BeanNameURL映射 HelloController&quot;"></p> <hr> <h3 id="注解"><a href="#注解" class="header-anchor">#</a> 注解</h3> <p>基于注解的方式来配置URL映射. (推荐)
<img src="springmvc-HelloController_%E6%B3%A8%E8%A7%A3%E6%98%A0%E5%B0%84URL.png" alt="注解配置 HelloController"></p> <ul><li>这时的类不受限制<br>
但如果没有配置 视图解析器, 就要满足下列任一条件, 否则访问报错.
<ul><li>返回类型: <code>ModelAndView</code>, 可以空参.</li> <li>参数列表: 至少有<code>HttpServletResponse response</code>,返回类型不限制.</li></ul></li> <li>原因:
<ul><li>如果参数中没有response对象且返回值又没有返回ModelAndView对象,这时候springMVC是不知道处理的视图是哪个的?</li> <li>当请求<code>/hello</code>地址,去到方法后,没有ModelAndView对象,不知道如何去哪里找视图,会自动给你默认的视图<code>hello</code>, 相当于循环访问<code>/hello</code>, 报500错误.</li> <li>配置视图解析器, 就得到 <code>前缀 + hello + 后缀</code> 这个视图.</li></ul></li></ul> <h3 id="全注解"><a href="#全注解" class="header-anchor">#</a> 全注解</h3> <p>全注解方式: 不需要在配置文件配置<code>&lt;bean class=&quot;XxxController&quot;&gt;</code>.</p> <ol><li>导入AOP的包</li></ol> <ul><li>spring-aop-4.1.2.RELEASE.jar</li></ul> <ol start="2"><li>配置文件: 开启注解扫描 和 驱动支持</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- MVC注解驱动支持 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- 开启注解支持 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>demo<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><blockquote><ul><li>在 SpringMVC 的各个组件中, <code>处理器映射器</code>,<code>处理器适配器</code>,<code>视图解析器</code>称为 SpringMVC 的三大组件.</li> <li>使用 <code>&lt;mvc:annotation-driven&gt;</code> 自动加载 RequestMappingHandlerMapping(处理映射器) 和
RequestMappingHandlerAdapter(处理适配器).</li> <li>在配置文件中使用<code>&lt;mvc:annotation-driven&gt;</code>替代注解处理器和适配器的配置.</li></ul></blockquote> <ol start="3"><li>Controller类: 贴注解</li></ol> <p><img src="springmvc-%E5%85%A8%E6%B3%A8%E8%A7%A3Controller.png" alt="&quot;全注解 Controller&quot;"> <img src="springmvc-%E5%85%A8%E6%B3%A8%E8%A7%A3%E7%BB%93%E6%9E%9C.png" alt="&quot;全注解 结果&quot;"></p> <br> <h2 id="静态资源的处理"><a href="#静态资源的处理" class="header-anchor">#</a> 静态资源的处理</h2> <p><img src="springmvc-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE404.png" alt="&quot;静态资源访问404&quot;"></p> <ol><li>原因:</li></ol> <ul><li>Tomcat中有很多内置的servlet.<br>
比如说数据的回显,由Tomcat里面的servlet 将我们封装的java对象放在我们的jsp页面进行回显呢.</li> <li>同理,我们需要访问一个静态资源, Tomcat也有对应的servlet为我们处理,恰好该servlet的映射路径也为/ .</li> <li>Tomcat中的 web.xml 是先加载的,项目的 web.xml 是后加载的. 如果配置了相同的路径，后面的会覆盖前面的.
也就是说, springMVC中的 DispatcherServlet 的映射路径覆盖了Tomcat默认对静态资源的处理的路径.
如果配置为/,Tomcat对静态资源处理的Servlet就失效.</li></ul> <hr> <ol start="2"><li>解决:</li></ol> <ul><li>需要Spring添加支持静态资源处理的配置.</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 支持对静态资源的处理 --&gt;</span>
<span class="token comment">&lt;!-- default-servlet-name 默认为 default --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>default-servlet-handler</span> <span class="token attr-name">default-servlet-name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>服务器的servlet-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><blockquote><p>注意: 根据springMVC默认对URL的匹配处理, 当静态资源xxx.后缀名, xxx如果跟 @RequestMapping(&quot;/xxx&quot;) 重复, 就会当作URL名处理, 进入这个方法, 而不是去加载这个静态资源.</p></blockquote> <hr> <ul><li>在 springmvc 的配置文件中可以配置, 静态资源不过滤:</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 
    location : 路径,
    mapping : 文件,
    ** : 该目录下的文件以及子目录的文件
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>resources</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/css/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mapping</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/css/**<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>resources</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/img/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mapping</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/img/**<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>resources</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/js/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mapping</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/js/**<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><br> <h2 id="传参方式"><a href="#传参方式" class="header-anchor">#</a> 传参方式</h2> <ol><li>使用serlvet原生api</li></ol> <blockquote><p>localhost/param1?username=Hao</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/param1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <ol start="2"><li>方法形参</li></ol> <blockquote><p>localhost/param1?username=Hao</p></blockquote> <ul><li>前台传入的参数名和方法定义的形参名字一致(基于同名匹配规则)</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/param2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>前台名称和后台形参名字不一致,需要用@RequestParam(&quot;前台参数名&quot;)来注入</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/param2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">method1</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <ol start="3"><li>使用模型传参 (前台参数名字需要和模型中的属性名一致)</li></ol> <blockquote><p>localhost/param1?username=Hao&amp;age=18</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/param3&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <ul><li>传参: 模型+形参</li></ul> <p><img src="springmvc-%E6%A8%A1%E5%9E%8B+%E5%BD%A2%E5%8F%82_%E4%BC%A0%E5%8F%82.png" alt="&quot;模型+形参&quot;"></p> <hr> <ol start="4"><li>地址栏传参</li></ol> <blockquote><p>localhost/delete/5</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/delete/{delId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">method1</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;delId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <p><strong>总结：参数绑定</strong></p> <ul><li><p>基本类型: 基本类型,基本包装类,String</p></li> <li><p>集合类型: 数组,List,Map</p></li> <li><p>POJO类型: 实体类,关联类</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Sting</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Address</span> address<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th style="text-align:center;">类型</th> <th style="text-align:center;">参数名</th> <th style="text-align:left;">例子</th></tr></thead> <tbody><tr><td style="text-align:center;">实体类属性</td> <td style="text-align:center;">属性名</td> <td style="text-align:left;">name</td></tr> <tr><td style="text-align:center;">关联类属性</td> <td style="text-align:center;">实体类属性名.关联类属性名</td> <td style="text-align:left;">address.city</td></tr> <tr><td style="text-align:center;">数组/List(基本类型)</td> <td style="text-align:center;">集合名[索引]</td> <td style="text-align:left;">arr[0]</td></tr> <tr><td style="text-align:center;">数组/List(POJO类型)</td> <td style="text-align:center;">集合名[索引].POJO属性名</td> <td style="text-align:left;">list[0].city</td></tr> <tr><td style="text-align:center;">Map</td> <td style="text-align:center;">Map属性名</td> <td style="text-align:left;">map['default'].city</td></tr></tbody></table> <br> <h1 id="restful风格-url"><a href="#restful风格-url" class="header-anchor">#</a> RESTful风格 URL</h1> <ul><li><code>REST</code>: Representational State Transfer</li> <li>四种基本操作 (HTTP的方法):
<ul><li><code>GET</code> : 获取资源</li> <li><code>POST</code> : 新建资源</li> <li><code>PUT</code> : 更新资源</li> <li><code>DELETE</code> : 删除资源</li></ul></li></ul> <table><thead><tr><th style="text-align:center;">URL</th> <th style="text-align:center;">HTTP方法</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">/user</td> <td style="text-align:center;">GET</td> <td style="text-align:center;">遍历所有User</td></tr> <tr><td style="text-align:center;">/user/{id}</td> <td style="text-align:center;">GET</td> <td style="text-align:center;">获取对应id的User</td></tr> <tr><td style="text-align:center;">/user</td> <td style="text-align:center;">POST</td> <td style="text-align:center;">保存User</td></tr> <tr><td style="text-align:center;">/user</td> <td style="text-align:center;">PUT</td> <td style="text-align:center;">更新用户</td></tr> <tr><td style="text-align:center;">/user/{delId}</td> <td style="text-align:center;">DELETE</td> <td style="text-align:center;">删除对应delId的用户</td></tr></tbody></table> <ul><li>优点: 结构清晰、符合标准、易于理解、扩展方便，所以正得到越来越多网站的采用.</li></ul> <hr> <p>例子</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>
        path <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
        method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 遍历所有User</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>
        path <span class="token operator">=</span> <span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">,</span> 
        method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findById</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 获取对应id的User</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>
        path <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
        method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 保存User</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>
        path <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
        method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>PUT
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span> <span class="token class-name">User</span> user <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 更新用户</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>
        path <span class="token operator">=</span> <span class="token string">&quot;/{delId}&quot;</span><span class="token punctuation">,</span> 
        method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>DELETE
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;delId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 删除对应delId的用户</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 表单或ajax, 完成 URL访问 和 数据的传递 --&gt;</span>
</code></pre></div><hr> <p>问题:</p> <ul><li>表单只支持 GET 和 POST 的方式.</li> <li>ajax 通过 POST方式 传递的数据, 后台接收为null.</li></ul> <p>解决:</p> <ul><li>方式1: 配置Filter: <code>HiddenHttpMethodFilter</code></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- web.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>HiddenHttpMethodFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>HiddenHttpMethodFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 表单方式 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_method<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>HTTP方式<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- value: GET/POST/PUT/DELETE --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- ajax方式 --&gt;</span>
$.ajax({
    url:&quot;/user/10&quot;,
    type:&quot;post&quot;,
    data:{ _method:&quot;DELETE&quot; }
});
</code></pre></div><hr> <ul><li>方式2: 配置Filter: <code>HttpPutFormContentFilter</code><br>
只针对 PUT方式 有效 (该类已过时).</li></ul> <p>解决: ajax 通过 POST方式 传递的数据, 后台能够完全接收.</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- web.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>HttpPutFormContentFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.filter.HttpPutFormContentFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>HttpPutFormContentFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><br> <h2 id="类型转换器"><a href="#类型转换器" class="header-anchor">#</a> 类型转换器</h2> <ul><li>自定义类型转换器<br>
实现
org.springframework.core.convert.converter.Converter</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// S:接收类型   T:目标类型</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">T</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">S</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>自定义 字符串日期转换器</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
    默认 Date类型 接收字符串类型为 yyyy/MM/dd,
    现在URL: /hello?date=2019-05-10
*/</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">Date</span> date<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 解析 字符串yyyy-MM-dd 为 Date类型</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateConverter</span> <span class="token keyword">implements</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Date</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            date <span class="token operator">=</span> 
            <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> date<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- SpringMVC 配置文件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>annotation-driven</span> 
<span class="token attr-name">conversion-service</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>converterService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>converterService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.context.support.ConversionServiceFactoryBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>converters<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hao.springmvc.converter.DateConverter<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><br> <h2 id="中文乱码问题"><a href="#中文乱码问题" class="header-anchor">#</a> 中文乱码问题</h2> <ul><li><p>Get 方式</p> <ul><li><p><code>Tomcat 8</code><br>
Tomcat8 默认进行了url编码,get请求不乱码,Tomcat7会乱码.</p></li> <li><p><code>Tomcat 7</code></p></li></ul></li></ul> <p><img src="springmvc-%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81_get.png" alt="&quot;Get 中文乱码&quot;"><br>
解决<br> <img src="springmvc-%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81_get%E8%A7%A3%E5%86%B3.png" alt="&quot;解决&quot;"></p> <hr> <ul><li>Post 方式</li></ul> <p><img src="springmvc-%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81_post.png" alt="&quot;Post 中文乱码&quot;"><br>
解决: 配置Filter <code>CharacterEncodingFilter</code>,并配置参数encoding为UTF-8. (该方式只对 POST请求 有效)</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>CharacterEncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>
        org.springframework.web.filter.CharacterEncodingFilter
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>encoding<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>CharacterEncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>结果
<img src="springmvc-%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81_post%E8%A7%A3%E5%86%B3.png" alt="&quot;解决&quot;"></p> <br> <h2 id="拦截器"><a href="#拦截器" class="header-anchor">#</a> 拦截器</h2> <ol><li>编写: 拦截器类<code>XxxInterceptor</code></li></ol> <ul><li>实现接口 <code>org.springframework.web.servlet.HandlerInterceptor</code></li> <li>编写逻辑</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>
    <span class="token comment">// 请求Controller方法前-&gt;调用, 返回 true:放行, false:拦截(等于return,不再放行)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Controller方法执行之后,视图结合之前-&gt;调用</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// 视图结合之后-&gt;调用</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>配置拦截器</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 
            拦截的url
            path=&quot;/*&quot;, 拦截 localhost/*
            path=&quot;/**&quot;, 拦截 localhost/*/*
        --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>mapping</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 
            排除的url
            path=&quot;/hello&quot;, 排除 localhost/hello
            path=&quot;/test/hello&quot;, 排除 localhost/test/hello
        --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>exclude-mapping</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/hello<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 拦截器类 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>demo.MyInterceptor<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><hr> <p><img src="springmvc-%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE.png" alt="&quot;拦截器链&quot;"></p> <br> <h2 id="传值方式"><a href="#传值方式" class="header-anchor">#</a> 传值方式</h2> <ol><li>通过serlvet<code>原生api方式</code>回显数据</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/value1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;小米&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/hello.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <ol start="2"><li>使用<code>ModelAndView</code>对象回显内容</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/value2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置数据</span>
    <span class="token comment">// key:&quot;test&quot;, value:&quot;小米&quot;</span>
    mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;小米&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// key:&quot;string&quot;(value类型的全小写), value:&quot;华为&quot;</span>
    mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">&quot;华为&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加一个Map&lt;String,Object&gt;类型: 多个key-value</span>
    mv<span class="token punctuation">.</span><span class="token function">addAllObjects</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置跳转视图</span>
    mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;/hello.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> mv<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <ol start="3"><li>直接返回<code>模型</code>对象</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
不配置 @ModelAttribute
    key:&quot;user&quot;(返回对象的类名全小写), value: 返回的对象
配置 @ModelAttribute(&quot;xxx&quot;)
    key:&quot;xxx&quot;, value: 返回的对象
*/</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/value3&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ModelAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;小米&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>但是这样, springMVC不知道去哪找视图, 会自动给你默认的视图: /value3. 所以一直重复访问: localhost/value3, 报错.</li></ul> <blockquote><p>配置视图解析器, 会根据视图解析器的 前缀(prefix) 和 后缀(suffix), 得到URL: <code>prefix + value3 + suffix</code>, 跳转到这个视图.</p></blockquote> <ul><li>配置视图解析器<br>
跳转到: /WEB-INF/value3.jsp</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.web.servlet.view.InternalResourceViewResolver<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>prefix<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/WEB-INF/<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>suffix<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>.jsp<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><hr> <ol start="4"><li>通过<code>Model</code>对象放入需要回显的内容</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/value4&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;小米&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>配置视图解析器,跳转视图: prefix + view + suffix</p></blockquote> <p>如果不需要加上前缀和后缀, 跳转到指定视图:</p> <ul><li><code>return &quot;forward:xxx.jsp&quot;</code>  (请求转发)</li> <li><code>return &quot;redirect:xxx.jsp&quot;</code> (重定向)</li></ul> <br> <h2 id="文件上传"><a href="#文件上传" class="header-anchor">#</a> 文件上传</h2> <ol><li>导入文件上传的相关jar包.</li></ol> <ul><li>com.springsource.org.apache.commons.fileupload-1.2.0.jar</li> <li>com.springsource.org.apache.commons.io-1.4.0.jar</li></ul> <ol start="2"><li>在配置文件springmvc.xml中 配置文件上传解析器</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- id 必须是 multipartResolver --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>multipartResolver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.web.multipart.commons.CommonsMultipartResolver<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>maxUploadSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#{10*1024*1024}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="3"><li>编写方法</li></ol> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// MultipartFile file: 变量名必须和 &lt;input name=&quot;file&quot; type=&quot;file&quot;/&gt;的name值一致.</span>
        <span class="token comment">// file.getName() 获取&lt;input name=&quot;xxx&quot;&gt;的name: xxx</span>
        <span class="token comment">// file.getOriginalFilename() 获取文件原来的名字</span>
        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputStream</span> os <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            is <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;e:/&quot;</span><span class="token punctuation">,</span>file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> os<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>is <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>os <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><br> <h2 id="文件下载"><a href="#文件下载" class="header-anchor">#</a> 文件下载</h2> <p>springMVC没有做太多的封装,还是使用serlvet下载文件.</p> <blockquote><p>localhost/download?fileName=test.jar</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/download&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">)</span><span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Disposition&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attachment;filename=&quot;</span><span class="token operator">+</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileInputStream</span> is <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>

        is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;e:/&quot;</span><span class="token punctuation">,</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ServletOutputStream</span> os <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> os<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> is <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h2 id="常用注解"><a href="#常用注解" class="header-anchor">#</a> 常用注解</h2> <h3 id="requestmapping"><a href="#requestmapping" class="header-anchor">#</a> @RequestMapping</h3> <ul><li><p>作用: 用于建立请求 URL 和处理请求方法之间的对应关系.</p></li> <li><p>位置:</p> <ul><li>类: URL的第一级访问路径.</li> <li>方法: URL的第二级访问路径.</li></ul></li> <li><p>属性:</p> <ul><li>value: 用于指定请求的URL. 跟属性path一样的作用.</li> <li>method: 用于指定请求的方式.</li> <li>params: 用于指定限制请求参数的条件. 它支持简单的表达式. 要求请求参数的 key 和 value 必须和配置的一模一样.</li> <li>headers: 用于指定限制请求消息头的条件.</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span><span class="token punctuation">(</span><span class="token string">&quot;helloController&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/demo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>
            value <span class="token operator">=</span> <span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span>
            method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">,</span>
            params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age!=90&quot;</span><span class="token punctuation">}</span>
            <span class="token comment">// URL参数必须有name和age, 且age不能等于90</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// TODO</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="requestparam"><a href="#requestparam" class="header-anchor">#</a> @RequestParam</h3> <ul><li><p>作用: 把请求中指定名称的参数给控制器中的形参赋值.</p></li> <li><p>位置: 方法的形参.</p></li> <li><p>属性:</p> <ul><li>value: 请求参数中的名称.</li> <li>required: 请求参数中是否必须提供此参数.<br>
默认值: true. 表示必须提供,如果不提供将报错.</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// TODO  </span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="pathvariable"><a href="#pathvariable" class="header-anchor">#</a> @PathVariable</h3> <ul><li><p>作用: 用于绑定 URL 中的占位符.<br>
url 支持占位符是 spring3.0 之后加入的, 是 springmvc 支持 REST风格 URL 的一个重要标志.</p></li> <li><p>位置: 方法的形参.</p></li> <li><p>属性:</p> <ul><li>value: 用于指定 URL 中占位符名称.</li> <li>required: 是否必须提供占位符.</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/delete/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="modelattribute"><a href="#modelattribute" class="header-anchor">#</a> @ModelAttribute</h3> <ul><li>作用:
<ul><li>贴在方法上, 执行请求方法前, 先执行所有被贴方法.</li> <li>贴在形参上, 从被贴方法的 <code>返回的POJO对象</code> 或 <code>形参注入的Map</code> 中获取对应key的value赋值给形参.</li></ul></li> <li>位置:
<ul><li>方法.</li> <li>方法的形参.</li></ul></li> <li>属性:
<ul><li>name: 获取数据的 key, 获取不到返回 空字符串''.<br>
key 可以是 POJO 的属性名称, 也可以是 Map 的 key.</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
先执行方法 loadUser()：

    如果 @ModelAttribute 没有设置属性, 再执行方法 hello(User user)时, 按照形参的类型(如User) 将被贴方法返回的值注入到形参.

    如果 @ModelAttribute 设置属性, 再执行方法 hello()时, 按照 @ModelAttribute(&quot;u&quot;) 找到 key=u 对应的被贴方法返回的值注入到形参.
*/</span>

<span class="token annotation punctuation">@ModelAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">loadUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;Hao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@ModelAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span><span class="token punctuation">)</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
先执行方法 load(), 注意: Map必须时形参注入进来,
再执行hello(), 按照key=word, 从Map中获取对应的value 注入到形参.
*/</span>

<span class="token annotation punctuation">@ModelAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">{</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;word&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@ModelAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;word&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> word<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="cookievalue"><a href="#cookievalue" class="header-anchor">#</a> @CookieValue</h3> <ul><li>作用: 获取指定名称 cookie 的value.</li> <li>位置: 方法的形参.</li> <li>属性:
<ul><li>name: cookie的name.</li> <li>required: 默认true, 必须存在指定名称的cookie, 否则报错.<br>
如果 required=false ,取不到该cookie, 返回的value为空.</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="sessionattribute"><a href="#sessionattribute" class="header-anchor">#</a> @SessionAttribute</h3> <ul><li>作用: 获取 session 指定名称的 attribute.</li> <li>位置: 方法的形参.</li> <li>属性:
<ul><li>name: session的name.</li> <li>required: 默认true, session必须存在指定名称的attribute, 否则报错.<br>
如果 required=false ,取不到值返回 null.</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@SessionAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="sessionattributes"><a href="#sessionattributes" class="header-anchor">#</a> @SessionAttributes</h3> <ul><li>作用: 将 模型 中的数据存储一份到session中.</li> <li>位置: 类.</li> <li>属性:
<ul><li>names: 指定模型中哪些 name-attribute 存储到session中.</li> <li>types: 根据指定参数的类型,将模型中对应类型的参数存储到session中.</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span><span class="token punctuation">(</span><span class="token string">&quot;helloController&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SessionAttributes</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意中文乱码</span>
        <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="responsebody"><a href="#responsebody" class="header-anchor">#</a> @ResponseBody</h3> <ul><li><p>作用: 在返回方法加上 <code>@ResponseBody</code> (表示: 请求不再交给springMVC处理,会结合JSON包,将对象解析成JSON字符串)</p></li> <li><p>位置:</p> <ul><li>类</li> <li>方法</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/json&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;小米&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>访问: localhost/json</p></blockquote> <blockquote><p>结果: {&quot;username&quot;:&quot;小米&quot;,&quot;age&quot;:18}</p></blockquote> <hr> <h4 id="jackson"><a href="#jackson" class="header-anchor">#</a> jackson</h4> <p>springMVC默认使用 <code>jackson</code> 对java对象和json进行转换.</p> <ul><li>引入jackson的jar包
<ul><li>jackson-databind-2.9.8.jar</li> <li>jackson-core-2.9.8.jar</li> <li>jackson-annotations-2.9.8.jar</li></ul></li></ul> <hr> <h4 id="fastjson"><a href="#fastjson" class="header-anchor">#</a> fastjson</h4> <ul><li>导入fastjson的jar包</li> <li>配置文件springmvc.xml中配置用fastjson解析.</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>message-converters</span> <span class="token attr-name">register-defaults</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>defaultCharset<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>message-converters</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><br> <h2 id="区别struts2"><a href="#区别struts2" class="header-anchor">#</a> 区别Struts2</h2> <h3 id="源码解析"><a href="#源码解析" class="header-anchor">#</a> 源码解析</h3> <p><img src="springmvc-%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="&quot;springMVC 流程图&quot;"></p> <blockquote><ul><li><code>HanderMapping</code> 请求映射处理器:(说明书)<br>
作用: 根据不同的请求选择最合适的处理器(自己编写的控制器),请求映射处理器可以配置多个,谁最先匹配就执行谁.</li></ul></blockquote> <blockquote><ul><li><code>Handler</code> 处理器<br>
作用: 它就是开发中要编写的具体业务控制器.<br>
由 <code>DispatcherServlet</code> 把请求转发到<code>Handler</code>. 由<code>Handler</code>对具体的用户请求进行处理.</li></ul></blockquote> <blockquote><ul><li><code>HandlerAdapter</code> 处理器适配器:(工具)<br>
作用: 支持多种类型的处理器,如何来执行&quot;处理器(控制器)&quot;.</li></ul></blockquote> <blockquote><ul><li><code>ViewResolver</code> 视图解析器<br>
作用: 负责将处理结果生成<code>View</code>视图.<br> <code>ViewResolver</code>首先根据逻辑视图名解析成物理视图名(即具体的页面地址), 再生成<code>View</code>视图对象，最后对<code>View</code>进行渲染将处理结果通过页面展示给用户.</li></ul></blockquote> <blockquote><ul><li><code>View</code> 视图:(最常用的视图就是 <code>jsp</code>)<br>
作用: 一般情况下需要通过页面标签或页面模版技术将模型数据通过页面展示给用户，需要由程序员根据业务需求开发具体的页面.</li></ul></blockquote> <p><img src="springmvc-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.png" alt="&quot;springMVC 源码解析&quot;"></p> <br> <h3 id="区别-springmvc-与-struts2"><a href="#区别-springmvc-与-struts2" class="header-anchor">#</a> 区别: springMVC 与 Struts2</h3> <ol><li>实现机制</li></ol> <ul><li>Struts2是基于过滤器实现的.</li> <li>Springmvc基于servlet实现.</li></ul> <hr> <ol start="2"><li>运行速度: Servlet比Filter快.</li></ol> <ul><li><p>Struts2是 多例, 基于类设计.<br>
每一次请求，都会创建一个Action对象. 请求来了以后，struts2创建多少个对象：ActionContext，valuestack，UAction，ActionSuport，ModelDriven.</p></li> <li><p>Springmvc是 单例, 基于方法设计.<br>
同一个Controller的请求, 只会创建一个Controller.</p></li></ul> <hr> <ol start="3"><li>参数封装来分析</li></ol> <ul><li>Struts基于属性进行封装, Action有参数属性.</li> <li>springMVC基于方法封装, 参数是写在Controller的方法.</li></ul> <br> <h2 id="纯注解版"><a href="#纯注解版" class="header-anchor">#</a> 纯注解版</h2> <h3 id="servlet-3-0-新特性"><a href="#servlet-3-0-新特性" class="header-anchor">#</a> Servlet 3.0 新特性</h3> <ul><li>Servlet 3.0 必须 <strong>Tomcat7及以上</strong>。</li> <li>@WebServlet</li> <li>@WebFilter</li> <li>@WebInitParam</li> <li>@WebListener</li> <li>@MultipartConfig</li></ul> <h3 id="servletcontainerinitializer"><a href="#servletcontainerinitializer" class="header-anchor">#</a> ServletContainerInitializer</h3> <ul><li>Servlet容器在启动应用的时候，会扫描当前应用每一个jar包里面
<strong>/META-INF/services/javax.servlet.ServletContainerInitializer</strong>
(文件内容写ServletContainerInitializer实现类的全类名)
文件指定的 <strong>ServletContainerInitializer实现类</strong> ，启动并运行这个实现类的 <strong>onStartup</strong> 方法。</li></ul> <p><img src="springmvc-ServletContainerInitializer.png" alt="&quot;ServletContainerInitializer&quot;"></p> <hr> <ul><li><p>ServletContext <strong>注册三大组件</strong></p> <ul><li>必须是在Web应用启动来添加组件。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServletContainerInitializer</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContainerInitializer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStartup</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">,</span> <span class="token class-name">ServletContext</span> servletContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
		<span class="token comment">// 下面的操作</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>注册 <strong>Servlet</strong></p> <ul><li><div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">// 添加 &lt;servlet&gt;</span>
  <span class="token function">addServlet</span><span class="token punctuation">(</span> <span class="token class-name">String</span> servletName<span class="token punctuation">,</span> <span class="token class-name">String</span> className <span class="token punctuation">)</span>
  <span class="token function">addServlet</span><span class="token punctuation">(</span> <span class="token class-name">String</span> servletName<span class="token punctuation">,</span> <span class="token class-name">Servlet</span> servlet <span class="token punctuation">)</span>
  <span class="token function">addServlet</span><span class="token punctuation">(</span> <span class="token class-name">String</span> servletName<span class="token punctuation">,</span> <span class="token class-name">Class</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Servlet</span><span class="token punctuation">&gt;</span></span> servletClass <span class="token punctuation">)</span>
</code></pre></div></li> <li><div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">// 配置 &lt;servlet-mapping&gt;</span>
  <span class="token function">addMapping</span><span class="token punctuation">(</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> urlPatterns <span class="token punctuation">)</span>
</code></pre></div></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 添加&lt;servlet&gt;</span>
<span class="token class-name">ServletRegistration</span><span class="token punctuation">.</span><span class="token class-name">Dynamic</span> helloServlet <span class="token operator">=</span> 
    servletContext<span class="token punctuation">.</span><span class="token function">addServlet</span><span class="token punctuation">(</span><span class="token string">&quot;helloServlet&quot;</span><span class="token punctuation">,</span> <span class="token class-name">HelloServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置&lt;servlet-mapping&gt;</span>
helloServlet<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>注册 <strong>Filter</strong></p> <ul><li><div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">// 添加 &lt;filter&gt;</span>
  <span class="token function">addFilter</span><span class="token punctuation">(</span> <span class="token class-name">String</span> filterName<span class="token punctuation">,</span> <span class="token class-name">String</span> className <span class="token punctuation">)</span>
  <span class="token function">addFilter</span><span class="token punctuation">(</span> <span class="token class-name">String</span> filterName<span class="token punctuation">,</span> <span class="token class-name">Filter</span> filter <span class="token punctuation">)</span>
  <span class="token function">addFilter</span><span class="token punctuation">(</span> <span class="token class-name">String</span> filterName<span class="token punctuation">,</span> <span class="token class-name">Class</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Filter</span><span class="token punctuation">&gt;</span></span> filterClass <span class="token punctuation">)</span>
</code></pre></div></li> <li><div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">// 配置 &lt;filter-mapping&gt;</span>
  <span class="token function">addMappingForServletNames</span><span class="token punctuation">(</span> <span class="token class-name">EnumSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DispatcherType</span><span class="token punctuation">&gt;</span></span> dispatcherTypes<span class="token punctuation">,</span> 
                            <span class="token keyword">boolean</span> isMatchAfter<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> servletNames <span class="token punctuation">)</span>
      
  <span class="token function">addMappingForUrlPatterns</span><span class="token punctuation">(</span> <span class="token class-name">EnumSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DispatcherType</span><span class="token punctuation">&gt;</span></span> dispatcherTypes<span class="token punctuation">,</span> 
                           <span class="token keyword">boolean</span> isMatchAfter<span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> urlPatterns <span class="token punctuation">)</span>
</code></pre></div></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 添加 &lt;filter&gt;</span>
<span class="token class-name">FilterRegistration</span><span class="token punctuation">.</span><span class="token class-name">Dynamic</span> helloFilter <span class="token operator">=</span> 
    servletContext<span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token string">&quot;helloFilter&quot;</span><span class="token punctuation">,</span> <span class="token class-name">HelloFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置 &lt;filter-mapping&gt;</span>
helloFilter<span class="token punctuation">.</span><span class="token function">addMappingForUrlPatterns</span><span class="token punctuation">(</span> <span class="token class-name">EnumSet</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">DispatcherType</span><span class="token punctuation">.</span>REQUEST<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>注册 <strong>Listener</strong></p> <ul><li><div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">// 添加 &lt;listener&gt;</span>
  <span class="token function">addListener</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span>
  <span class="token function">addListener</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token comment">// &lt;T extends EventListener&gt;</span>
  <span class="token function">addListener</span><span class="token punctuation">(</span><span class="token class-name">Class</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">EventListener</span><span class="token punctuation">&gt;</span></span> listenerClass<span class="token punctuation">)</span>
</code></pre></div></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 添加 &lt;listener&gt;</span>
<span class="token function">addListener</span><span class="token punctuation">(</span> <span class="token class-name">HelloListener</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 注意：因为是ServletContainerInitializer的实现类，是在容器创建时添加Listener，所以Listener必须时 ServletContextListener 的实现类。</span>
</code></pre></div></li></ul></li></ul> <h3 id="handlestypes"><a href="#handlestypes" class="header-anchor">#</a> @HandlesTypes</h3> <ul><li>给 <strong>ServletContainerInitializer实现类</strong> 传递：感兴趣类。</li> <li>传递的是接口, ServletContainerInitializer实现类的onStartup方法可以拿到 感兴趣类的子类(子接口, 实现类).</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@HandlesTypes</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">IHelloService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServletContainerInitializer</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContainerInitializer</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * @param c     感兴趣类的所有子类型, 但不包含感兴趣类本身
     *              (感兴趣类就是: @HandlesTypes传递过来的类数组)
     *
     * @param ctx   当前Web应用的ServletContext
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStartup</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">,</span> <span class="token class-name">ServletContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过 c 拿到感性类的子类来创建对象......</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="异步请求"><a href="#异步请求" class="header-anchor">#</a> 异步请求</h3> <ul><li>异步请求：请求执行完非异步代码，归还线程到线程池。再获取新的线程执行异步代码。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 开启异步的支持</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> asyncSupported <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开始异步</span>
        <span class="token class-name">AsyncContext</span> asyncContext <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">startAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行异步业务</span>
        asyncContext<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 异步业务代码...</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>普通Listener不能监听到 异步代码的执行。
异步Listener：实现 <code>javax.servlet.AsyncListener</code> 接口。</li></ul> <h3 id="整合springmvc"><a href="#整合springmvc" class="header-anchor">#</a> 整合SpringMVC</h3> <ol><li><p>导入依赖。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>SpringMVC内置 /META-INF/services/javax.servlet.ServletContainerInitializer 文件，并指定了实现类。</p> <p><img src="springmvc-spring-web-ServletContainerIntializer.png" alt="&quot;ServletContainerIntializer&quot;"></p> <ul><li><p>实现类 : <code>org.springframework.web.SpringServletContainerInitializer</code></p> <ul><li>SpringMVC一启动就会加载感兴趣类 <code>org.springframework.web.WebApplicationInitializer</code> 接口的所有组件，并且为 WebApplicationInitializer接口 创建对象(组件不是接口，抽象类)。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@HandlesTypes</span><span class="token punctuation">(</span><span class="token class-name">WebApplicationInitializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringServletContainerInitializer</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContainerInitializer</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>WebApplicationInitializer 的组件
<ul><li><strong>AbstractContextLoaderInitializer</strong>
创建IOC根容器。</li> <li><strong>AbstractDispatcherServletInitializer</strong>
创建Web的IOC容器，创建了DispatcherServlet对象，将这个servlet添加到ServletContext。暴露方法 getServletMappings()，实现类重写这个方法，配置DispatcherServlet的mapping。</li> <li><strong>AbstractAnnotationConfigDispatcherServletInitializer</strong>
创建一个IOC根容器，并传入配置类。再创建一个Web的IOC容器，传入web配置类。</li></ul></li></ul></li></ul></li> <li><p>以注解方式启动SpringMVC</p> <ul><li><p>继承  <code>AbstractAnnotationConfigDispatcherServletInitializer</code>，实现指定的抽象方法，指定DispatcherServlet的配置信息。</p> <p><img src="springmvc-spring%E5%AE%B9%E5%99%A8context.png" alt="&quot;Spring容器context&quot;"></p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebApplicationInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 获取根容器的配置类
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token class-name">RootConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取Web容器的配置类
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token class-name">WebConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取DispacherServlet的映射信息
     *      /  ：拦截所有请求，包括静态资源(js/css/html)，但不包括jsp
     *      /* ：拦截所有请求，包括静态资源和jsp
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token string">&quot;/&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
 * web容器启动注册三大组件
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStartup</span><span class="token punctuation">(</span><span class="token class-name">ServletContext</span> servletContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStartup</span><span class="token punctuation">(</span>servletContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 注册 servlet, filter, listener</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@ComponentScans</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.hao.dao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.hao.service&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Configuration</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RootConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><pre><code>```java
@ComponentScan(&quot;com.hao.web.controller&quot;)
@Configuration
public class WebConfig {
}
```
</code></pre> <p>​</p> <h2 id="定制springmvc"><a href="#定制springmvc" class="header-anchor">#</a> 定制SpringMVC</h2> <h3 id="enablewebmvc"><a href="#enablewebmvc" class="header-anchor">#</a> @EnableWebMvc</h3> <ul><li>相当于 <code>&lt;mvc:annotation-config/&gt;</code></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="webmvcconfigurer"><a href="#webmvcconfigurer" class="header-anchor">#</a> WebMvcConfigurer</h3> <ul><li><code>org.springframework.web.servlet.config.annotation.WebMvcConfigurer</code> 实现类: 定制SpringMVC，可以用来配置 视图解析器、拦截器、静态资源......
WebMvcConfigurerAdapter 是以前WebMvcConfigurer的空方法实现类，现已淘汰。</li> <li>前提：<strong>@EnableWebMvc</strong></li></ul> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>void <strong>configureViewResolvers</strong>(ViewResolverRegistry registry)</td> <td>视图解析器</td></tr> <tr><td>void <strong>configureDefaultServletHandling</strong>(DefaultServletHandlerConfigurer configurer)</td> <td>静态资源</td></tr> <tr><td>void <strong>addInterceptors</strong>(InterceptorRegistry registry)</td> <td>拦截器</td></tr> <tr><td>......</td> <td>......</td></tr></tbody></table> <h2 id="异步请求-2"><a href="#异步请求-2" class="header-anchor">#</a> 异步请求</h2> <h3 id="callable"><a href="#callable" class="header-anchor">#</a> Callable</h3> <ul><li>Controller方法的返回类型为<code>java.util.concurrent.Callable</code>，就支持异步请求。
异步代码写在Callable接口的call方法内，使用异步线程池的线程来执行异步代码。</li> <li>DispatcherServlet和全部Filter退出这个请求方法的线程，但是response依然打开状态。</li> <li>根据Callable返回的结果，SpringMVC将请求重新派发给容器，恢复之前的处理，继续进行视图渲染等流程。
当然重新派发的请求，拦截器一样能拦截到，且拦截的请求URL与之前的一样。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">V</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Controller方法</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 代码...</span>
    <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> callable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
            <span class="token comment">// 异步代码...</span>
            <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 代码...</span>
    <span class="token keyword">return</span> callable<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>由上可得，普通拦截器不能拦截到 异步代码的执行。
异步拦截器：实现 <code>org.springframework.web.servlet.AsyncHandlerInterceptor</code> 接口。</li></ul> <h3 id="deferredresult"><a href="#deferredresult" class="header-anchor">#</a> DeferredResult</h3> <ul><li><code>org.springframework.web.context.request.async.DeferredResult</code> ：异步请求。</li> <li>请求方法可以将DeferredResult对象 保存起来，这样其他请求可以获取这个DeferredResult对象。
这个DeferredResult对象只要调用 <strong>setResult( Object result )</strong> 方法，SpringMVC就会派发这个异步请求，
将设置的 result对象 作为原来请求的返回结果，继续进行视图渲染等流程。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>
	<span class="token comment">// 用于保存DeferredResult对象，该Controller其他方法调用</span>
    <span class="token keyword">private</span> <span class="token class-name">DeferredResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result<span class="token punctuation">;</span>

	<span class="token comment">/**
     * 创建异步请求
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/create&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DeferredResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 创建一个DeferredResult对象：3秒内没有执行setResult()方法，返回结果为&quot;FAIL&quot;</span>
        <span class="token class-name">DeferredResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> deferredResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeferredResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3000L</span><span class="token punctuation">,</span> <span class="token string">&quot;FAIL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 保存DeferredResult对象</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> deferredResult<span class="token punctuation">;</span>
        <span class="token keyword">return</span> deferredResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 处理异步请求
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/handle&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> result <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// DeferredResult对象设置结果，请求会自动派发，返回结果就是&quot;FINISH&quot;</span>
            result<span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span><span class="token string">&quot;FINISH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.04a292d2.js" defer></script><script src="/assets/js/2.4fad892d.js" defer></script><script src="/assets/js/12.013bff42.js" defer></script>
  </body>
</html>
